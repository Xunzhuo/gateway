
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>HTTP Routing &#8212; Envoy Gateway  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="HTTP Redirects" href="http-redirect.html" />
    <link rel="prev" title="Quickstart" href="quickstart.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="http-routing">
<h1>HTTP Routing<a class="headerlink" href="#http-routing" title="Permalink to this heading">¶</a></h1>
<p>The <a class="reference external" href="https://gateway-api.sigs.k8s.io/api-types/httproute/">HTTPRoute</a> resource allows users to configure HTTP routing by matching HTTP traffic and forwarding it to
Kubernetes backends. Currently, the only supported backend supported by Envoy Gateway is a Service resource. This guide
shows how to route traffic based on host, header, and path fields and forward the traffic to different Kubernetes
Services. To learn more about HTTP routing, refer to the <a class="reference external" href="https://gateway-api.sigs.k8s.io/">Gateway API documentation</a>.</p>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading">¶</a></h2>
<p>Install Envoy Gateway:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://github.com/envoyproxy/gateway/releases/download/v0.2.0/install.yaml
</pre></div>
</div>
<p>Wait for Envoy Gateway to become available:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span><span class="nb">wait</span><span class="w"> </span>--timeout<span class="o">=</span>5m<span class="w"> </span>-n<span class="w"> </span>envoy-gateway-system<span class="w"> </span>deployment/envoy-gateway<span class="w"> </span>--for<span class="o">=</span><span class="nv">condition</span><span class="o">=</span>Available
</pre></div>
</div>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this heading">¶</a></h2>
<p>Install the HTTP routing example resources:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://raw.githubusercontent.com/envoyproxy/gateway/v0.2.0/examples/kubernetes/http-routing.yaml
</pre></div>
</div>
<p>The manifest installs a <a class="reference external" href="https://gateway-api.sigs.k8s.io/api-types/gatewayclass/">GatewayClass</a>, <a class="reference external" href="https://gateway-api.sigs.k8s.io/api-types/gateway/">Gateway</a>, four Deployments, four Services, and three HTTPRoute resources.
The GatewayClass is a cluster-scoped resource that represents a class of Gateways that can be instantiated.</p>
<p><strong>Note:</strong> Envoy Gateway is configured by default to manage a GatewayClass with
<code class="docutils literal notranslate"><span class="pre">controllerName:</span> <span class="pre">gateway.envoyproxy.io/gatewayclass-controller</span></code>.</p>
</section>
<section id="verification">
<h2>Verification<a class="headerlink" href="#verification" title="Permalink to this heading">¶</a></h2>
<p>Check the status of the GatewayClass:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>get<span class="w"> </span>gc<span class="w"> </span>--selector<span class="o">=</span><span class="nv">example</span><span class="o">=</span>http-routing
</pre></div>
</div>
<p>The status should reflect “Accepted=True”, indicating Envoy Gateway is managing the GatewayClass.</p>
<p>A Gateway represents configuration of infrastructure. When a Gateway is created, <a class="reference external" href="https://www.envoyproxy.io/">Envoy proxy</a> infrastructure is
provisioned or configured by Envoy Gateway. The <code class="docutils literal notranslate"><span class="pre">gatewayClassName</span></code> defines the name of a GatewayClass used by this
Gateway. Check the status of the Gateway:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>get<span class="w"> </span>gateways<span class="w"> </span>--selector<span class="o">=</span><span class="nv">example</span><span class="o">=</span>http-routing
</pre></div>
</div>
<p>The status should reflect “Ready=True”, indicating the Envoy proxy infrastructure has been provisioned. The status also
provides the address of the Gateway. This address is used later in the guide to test connectivity to proxied backend
services.</p>
<p>The three HTTPRoute resources create routing rules on the Gateway. In order to receive traffic from a Gateway,
an HTTPRoute must be configured with <code class="docutils literal notranslate"><span class="pre">parentRefs</span></code> which reference the parent Gateway(s) that it should be attached to.
An HTTPRoute can match against a <a class="reference external" href="https://gateway-api.sigs.k8s.io/references/spec/#gateway.networking.k8s.io/v1beta1.HTTPRouteSpec">single set of hostnames</a>. These hostnames are matched before any other matching
within the HTTPRoute takes place. Since <code class="docutils literal notranslate"><span class="pre">example.com</span></code>, <code class="docutils literal notranslate"><span class="pre">foo.example.com</span></code>, and <code class="docutils literal notranslate"><span class="pre">bar.example.com</span></code> are separate hosts with
different routing requirements, each is deployed as its own HTTPRoute - <code class="docutils literal notranslate"><span class="pre">example-route,</span> <span class="pre">``foo-route</span></code>, and <code class="docutils literal notranslate"><span class="pre">bar-route</span></code>.</p>
<p>Check the status of the HTTPRoutes:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>get<span class="w"> </span>httproutes<span class="w"> </span>--selector<span class="o">=</span><span class="nv">example</span><span class="o">=</span>http-routing<span class="w"> </span>-o<span class="w"> </span>yaml
</pre></div>
</div>
<p>The status for each HTTPRoute should surface “Accepted=True” and a <code class="docutils literal notranslate"><span class="pre">parentRef</span></code> that references the example Gateway.
The <code class="docutils literal notranslate"><span class="pre">example-route</span></code> matches any traffic for “example.com” and forwards it to the “example-svc” Service.</p>
</section>
<section id="testing-the-configuration">
<h2>Testing the Configuration<a class="headerlink" href="#testing-the-configuration" title="Permalink to this heading">¶</a></h2>
<p>Before testing HTTP routing to the <code class="docutils literal notranslate"><span class="pre">example-svc</span></code> backend, get the Gateway’s address.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">GATEWAY_HOST</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>gateway/example-gateway<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.status.addresses[0].value}&#39;</span><span class="k">)</span>
</pre></div>
</div>
<p>Test HTTP routing to the <code class="docutils literal notranslate"><span class="pre">example-svc</span></code> backend.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-vvv<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Host: example.com&quot;</span><span class="w"> </span><span class="s2">&quot;http://</span><span class="si">${</span><span class="nv">GATEWAY_HOST</span><span class="si">}</span><span class="s2">/&quot;</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">200</span></code> status code should be returned and the body should include <code class="docutils literal notranslate"><span class="pre">&quot;pod&quot;:</span> <span class="pre">&quot;example-backend-*&quot;</span></code> indicating the traffic
was routed to the example backend service. If you change the hostname to a hostname not represented in any of the
HTTPRoutes, e.g. “www.example.com”, the HTTP traffic will not be routed and a <code class="docutils literal notranslate"><span class="pre">404</span></code> should be returned.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">foo-route</span></code> matches any traffic for <code class="docutils literal notranslate"><span class="pre">foo.example.com</span></code> and applies its routing rules to forward the traffic to the
“foo-svc” Service. Since there is only one path prefix match for <code class="docutils literal notranslate"><span class="pre">/login</span></code>, only <code class="docutils literal notranslate"><span class="pre">foo.example.com/login/*</span></code> traffic will
be forwarded. Test HTTP routing to the <code class="docutils literal notranslate"><span class="pre">foo-svc</span></code> backend.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-vvv<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Host: foo.example.com&quot;</span><span class="w"> </span><span class="s2">&quot;http://</span><span class="si">${</span><span class="nv">GATEWAY_HOST</span><span class="si">}</span><span class="s2">/login&quot;</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">200</span></code> status code should be returned and the body should include <code class="docutils literal notranslate"><span class="pre">&quot;pod&quot;:</span> <span class="pre">&quot;foo-backend-*&quot;</span></code> indicating the traffic
was routed to the foo backend service. Traffic to any other paths that do not begin with <code class="docutils literal notranslate"><span class="pre">/login</span></code> will not be matched by
this HTTPRoute. Test this by removing <code class="docutils literal notranslate"><span class="pre">/login</span></code> from the request.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-vvv<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Host: foo.example.com&quot;</span><span class="w"> </span><span class="s2">&quot;http://</span><span class="si">${</span><span class="nv">GATEWAY_HOST</span><span class="si">}</span><span class="s2">/&quot;</span>
</pre></div>
</div>
<p>The HTTP traffic will not be routed and a <code class="docutils literal notranslate"><span class="pre">404</span></code> should be returned.</p>
<p>Similarly, the <code class="docutils literal notranslate"><span class="pre">bar-route</span></code> HTTPRoute matches traffic for <code class="docutils literal notranslate"><span class="pre">bar.example.com</span></code>. All traffic for this hostname will be
evaluated against the routing rules. The most specific match will take precedence which means that any traffic with the
<code class="docutils literal notranslate"><span class="pre">env:canary</span></code> header will be forwarded to <code class="docutils literal notranslate"><span class="pre">bar-svc-canary</span></code> and if the header is missing or not <code class="docutils literal notranslate"><span class="pre">canary</span></code> then it’ll be
forwarded to <code class="docutils literal notranslate"><span class="pre">bar-svc</span></code>. Test HTTP routing to the <code class="docutils literal notranslate"><span class="pre">bar-svc</span></code> backend.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-vvv<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Host: bar.example.com&quot;</span><span class="w"> </span><span class="s2">&quot;http://</span><span class="si">${</span><span class="nv">GATEWAY_HOST</span><span class="si">}</span><span class="s2">/&quot;</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">200</span></code> status code should be returned and the body should include <code class="docutils literal notranslate"><span class="pre">&quot;pod&quot;:</span> <span class="pre">&quot;bar-backend-*&quot;</span></code> indicating the traffic
was routed to the foo backend service.</p>
<p>Test HTTP routing to the <code class="docutils literal notranslate"><span class="pre">bar-canary-svc</span></code> backend by adding the <code class="docutils literal notranslate"><span class="pre">env:</span> <span class="pre">canary</span></code> header to the request.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-vvv<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Host: bar.example.com&quot;</span><span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;env: canary&quot;</span><span class="w"> </span><span class="s2">&quot;http://</span><span class="si">${</span><span class="nv">GATEWAY_HOST</span><span class="si">}</span><span class="s2">/&quot;</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">200</span></code> status code should be returned and the body should include <code class="docutils literal notranslate"><span class="pre">&quot;pod&quot;:</span> <span class="pre">&quot;bar-canary-backend-*&quot;</span></code> indicating the
traffic was routed to the foo backend service.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Envoy Gateway</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/compatibility.html">Compatibility Matrix</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../user_docs.html">User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design_docs.html">Design Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_docs.html">Developer Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about_docs.html">About the Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_involved.html">Getting Involved</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../user_docs.html">User Guides</a><ul>
      <li>Previous: <a href="quickstart.html" title="previous chapter">Quickstart</a></li>
      <li>Next: <a href="http-redirect.html" title="next chapter">HTTP Redirects</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;Envoy Gateway Project Authors | <a href="https://github.com/envoyproxy/gateway">GitHub</a> | <a href="/latest">Latest Docs</a>.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../_sources/user/http-routing.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>