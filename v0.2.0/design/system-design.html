
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>System Design &#8212; Envoy Gateway  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Gateway API Translator Design" href="gatewayapi-translator.html" />
    <link rel="prev" title="Design Docs" href="../design_docs.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="system-design">
<h1>System Design<a class="headerlink" href="#system-design" title="Permalink to this heading">¶</a></h1>
<section id="goals">
<h2>Goals<a class="headerlink" href="#goals" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Define the system components needed to satisfy the requirements of Envoy Gateway.</p></li>
</ul>
</section>
<section id="non-goals">
<h2>Non-Goals<a class="headerlink" href="#non-goals" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Create a detailed design and interface specification for each system component.</p></li>
</ul>
</section>
<section id="terminology">
<h2>Terminology<a class="headerlink" href="#terminology" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Control Plane- A collection of inter-related software components for providing application gateway and routing
functionality. The control plane is implemented by Envoy Gateway and provides services for managing the data plane.
These services are detailed in the <a class="reference internal" href="#components"><span class="std std-doc">components</span></a> section.</p></li>
<li><p>Data Plane- Provides intelligent application-level traffic routing and is implemented as one or more Envoy proxies.</p></li>
</ul>
</section>
<section id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Permalink to this heading">¶</a></h2>
<p><img alt="Architecture" src="../_images/architecture.png" /></p>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading">¶</a></h2>
<p>Envoy Gateway is configured statically at startup and the managed data plane is configured dynamically through
Kubernetes resources, primarily <a class="reference external" href="https://gateway-api.sigs.k8s.io">Gateway API</a> objects.</p>
<section id="static-configuration">
<h3>Static Configuration<a class="headerlink" href="#static-configuration" title="Permalink to this heading">¶</a></h3>
<p>Static configuration is used to configure Envoy Gateway at startup, i.e. change the GatewayClass controllerName,
configure a Provider, etc. Currently, Envoy Gateway only supports configuration through a configuration file. If the
configuration file is not provided, Envoy Gateway starts-up with default configuration parameters.</p>
</section>
<section id="dynamic-configuration">
<h3>Dynamic Configuration<a class="headerlink" href="#dynamic-configuration" title="Permalink to this heading">¶</a></h3>
<p>Dynamic configuration is based on the concept of a declaring the desired state of the data plane and using
reconciliation loops to drive the actual state toward the desired state. The desired state of the data plane is
defined as Kubernetes resources that provide the following services:</p>
<ul class="simple">
<li><p>Infrastructure Management- Manage the data plane infrastructure, i.e. deploy, upgrade, etc. This configuration is
expressed through <a class="reference external" href="https://gateway-api.sigs.k8s.io/concepts/api-overview/#gatewayclass">GatewayClass</a> and <a class="reference external" href="https://gateway-api.sigs.k8s.io/concepts/api-overview/#gateway">Gateway</a> resources. The <code class="docutils literal notranslate"><span class="pre">EnvoyProxy</span></code> <a class="reference external" href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/">Custom Resource</a> can be
referenced by <code class="docutils literal notranslate"><span class="pre">gatewayclass.spec.parametersRef</span></code> to modify data plane infrastructure default parameters,
e.g. expose Envoy network endpoints using a NodePort service instead of a LoadBalancer service.</p></li>
<li><p>Traffic Routing- Define how to handle application-level requests to backend services. For example, route all HTTP
requests for “www.example.com” to a backend service running a web server. This configuration is expressed through
<a class="reference external" href="https://gateway-api.sigs.k8s.io/concepts/api-overview/#httproute">HTTPRoute</a> and <a class="reference external" href="https://gateway-api.sigs.k8s.io/concepts/api-overview/#tlsroute">TLSRoute</a> resources that match, filter, and route traffic to a <a class="reference external" href="https://gateway-api.sigs.k8s.io/v1alpha2/references/spec/#gateway.networking.k8s.io/v1alpha2.BackendObjectReference">backend</a>.
Although a backend can be any valid Kubernetes Group/Kind resource, Envoy Gateway only supports a <a class="reference external" href="https://kubernetes.io/docs/concepts/services-networking/service/">Service</a>
reference.</p></li>
</ul>
</section>
</section>
<section id="components">
<h2>Components<a class="headerlink" href="#components" title="Permalink to this heading">¶</a></h2>
<p>Envoy Gateway is made up of several components that communicate in-process; how this communication happens is described
in the <a class="reference internal" href="watching.html"><span class="doc std std-doc">Watching Components Design</span></a>.</p>
<section id="provider">
<h3>Provider<a class="headerlink" href="#provider" title="Permalink to this heading">¶</a></h3>
<p>A Provider is an infrastructure component that Envoy Gateway calls to establish its runtime configuration, resolve
services, persist data, etc. As of v0.2, Kubernetes is the only implemented provider. A file provider is on the roadmap
via <a class="reference external" href="https://github.com/envoyproxy/gateway/issues/37">Issue #37</a>. Other providers can be added in the future as Envoy Gateway use cases are better understood. A
provider is configured at start up through Envoy Gateway’s <a class="reference internal" href="#static-configuration"><span class="std std-doc">static configuration</span></a>.</p>
<section id="kubernetes-provider">
<h4>Kubernetes Provider<a class="headerlink" href="#kubernetes-provider" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>Uses Kubernetes-style controllers to reconcile Kubernetes resources that comprise the
<a class="reference internal" href="#dynamic-configuration"><span class="std std-doc">dynamic configuration</span></a>.</p></li>
<li><p>Manages the data plane through Kubernetes API CRUD operations.</p></li>
<li><p>Uses Kubernetes for Service discovery.</p></li>
<li><p>Uses etcd (via Kubernetes API) to persist data.</p></li>
</ul>
</section>
<section id="file-provider">
<h4>File Provider<a class="headerlink" href="#file-provider" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>Uses a file watcher to watch files in a directory that define the data plane configuration.</p></li>
<li><p>Manages the data plane by calling internal APIs, e.g. <code class="docutils literal notranslate"><span class="pre">CreateDataPlane()</span></code>.</p></li>
<li><p>Uses the host’s DNS for Service discovery.</p></li>
<li><p>If needed, the local filesystem is used to persist data.</p></li>
</ul>
</section>
</section>
<section id="resource-watcher">
<h3>Resource Watcher<a class="headerlink" href="#resource-watcher" title="Permalink to this heading">¶</a></h3>
<p>The Resource Watcher watches resources used to establish and maintain Envoy Gateway’s dynamic configuration. The
mechanics for watching resources is provider-specific, e.g. informers, caches, etc. are used for the Kubernetes
provider. The Resource Watcher uses the configured provider for input and provides resources to the Resource Translator
as output.</p>
</section>
<section id="resource-translator">
<h3>Resource Translator<a class="headerlink" href="#resource-translator" title="Permalink to this heading">¶</a></h3>
<p>The Resource Translator translates external resources, e.g. GatewayClass, from the Resource Watcher to the Intermediate
Representation (IR). It is responsible for:</p>
<ul class="simple">
<li><p>Translating infrastructure-specific resources/fields from the Resource Watcher to the Infra IR.</p></li>
<li><p>Translating proxy configuration resources/fields from the Resource Watcher to the xDS IR.</p></li>
</ul>
<p><strong>Note:</strong> The Resource Translator is implemented as the <code class="docutils literal notranslate"><span class="pre">Translator</span></code> API type in the <code class="docutils literal notranslate"><span class="pre">gatewayapi</span></code> package.</p>
</section>
<section id="intermediate-representation-ir">
<h3>Intermediate Representation (IR)<a class="headerlink" href="#intermediate-representation-ir" title="Permalink to this heading">¶</a></h3>
<p>The Intermediate Representation defines internal data models that external resources are translated into. This allows
Envoy Gateway to be decoupled from the external resources used for dynamic configuration. The IR consists of an Infra IR
used as input for the Infra Manager and an xDS IR used as input for the xDS Translator.</p>
<ul class="simple">
<li><p>Infra IR- Used as the internal definition of the managed data plane infrastructure.</p></li>
<li><p>xDS IR- Used as the internal definition of the managed data plane xDS configuration.</p></li>
</ul>
</section>
<section id="xds-translator">
<h3>xDS Translator<a class="headerlink" href="#xds-translator" title="Permalink to this heading">¶</a></h3>
<p>The xDS Translator translates the xDS IR into xDS Resources that are consumed by the xDS server.</p>
</section>
<section id="xds-server">
<h3>xDS Server<a class="headerlink" href="#xds-server" title="Permalink to this heading">¶</a></h3>
<p>The xDS Server is a xDS gRPC Server based on <a class="reference external" href="https://github.com/envoyproxy/go-control-plane">Go Control Plane</a>. Go Control Plane implements the Delta xDS Server
Protocol and is responsible for using xDS to configure the data plane.</p>
</section>
<section id="infra-manager">
<h3>Infra Manager<a class="headerlink" href="#infra-manager" title="Permalink to this heading">¶</a></h3>
<p>The Infra Manager is a provider-specific component responsible for managing the following infrastructure:</p>
<ul class="simple">
<li><p>Data Plane - Manages all the infrastructure required to run the managed Envoy proxies. For example, CRUD Deployment,
Service, etc. resources to run Envoy in a Kubernetes cluster.</p></li>
<li><p>Auxiliary Control Planes - Optional infrastructure needed to implement application Gateway features that require
external integrations with the managed Envoy proxies. For example, <a class="reference external" href="https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/other_features/global_rate_limiting">Global Rate Limiting</a> requires provisioning
and configuring the <a class="reference external" href="https://github.com/envoyproxy/ratelimit">Envoy Rate Limit Service</a> and the <a class="reference external" href="https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/http/ratelimit/v3/rate_limit.proto#envoy-v3-api-msg-extensions-filters-http-ratelimit-v3-ratelimit">Rate Limit filter</a>. Such features are exposed to
users through the <a class="reference external" href="https://gateway-api.sigs.k8s.io/v1alpha2/api-types/httproute/#filters-optional">Custom Route Filters</a> extension.</p></li>
</ul>
<p>The Infra Manager consumes the Infra IR as input to manage the data plane infrastructure.</p>
</section>
</section>
<section id="design-decisions">
<h2>Design Decisions<a class="headerlink" href="#design-decisions" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Envoy Gateway consumes one <a class="reference external" href="https://gateway-api.sigs.k8s.io/concepts/api-overview/#gatewayclass">GatewayClass</a> by comparing its configured controller name with
<code class="docutils literal notranslate"><span class="pre">spec.controllerName</span></code> of a GatewayClass. If multiple GatewayClasses exist with the same <code class="docutils literal notranslate"><span class="pre">spec.controllerName</span></code>, Envoy
Gateway follows Gateway API <a class="reference external" href="https://gateway-api.sigs.k8s.io/concepts/guidelines/#conflicts">guidelines</a> to resolve the conflict.
<code class="docutils literal notranslate"><span class="pre">gatewayclass.spec.parametersRef</span></code> refers to the <code class="docutils literal notranslate"><span class="pre">EnvoyProxy</span></code> custom resource for configuring the managed proxy
infrastructure. If unspecified, default configuration parameters are used for the managed proxy infrastructure.</p></li>
<li><p>Envoy Gateway manages <a class="reference external" href="https://gateway-api.sigs.k8s.io/concepts/api-overview/#gateway">Gateways</a> that reference its GatewayClass.</p>
<ul>
<li><p>A Gateway resource causes Envoy Gateway to provision managed Envoy proxy infrastructure.</p></li>
<li><p>Envoy Gateway groups Listeners by Port and collapses each group of Listeners into a single Listener if the Listeners
in the group are compatible. Envoy Gateway considers Listeners to be compatible if all the following conditions are
met:</p>
<ul>
<li><p>Either each Listener within the group specifies the “HTTP” Protocol or each Listener within the group specifies
either the “HTTPS” or “TLS” Protocol.</p></li>
<li><p>Each Listener within the group specifies a unique “Hostname”.</p></li>
<li><p>As a special case, one Listener within a group may omit “Hostname”, in which case this Listener matches when no
other Listener matches.</p></li>
</ul>
</li>
<li><p>Envoy Gateway does <strong>not</strong> merge listeners across multiple Gateways.</p></li>
</ul>
</li>
<li><p>Envoy Gateway follows Gateway API <a class="reference external" href="https://gateway-api.sigs.k8s.io/concepts/guidelines/#conflicts">guidelines</a> to resolve any conflicts.</p>
<ul>
<li><p>A Gateway <code class="docutils literal notranslate"><span class="pre">listener</span></code> corresponds to an Envoy proxy <a class="reference external" href="https://www.envoyproxy.io/docs/envoy/latest/configuration/listeners/listeners#config-listeners">Listener</a>.</p></li>
</ul>
</li>
<li><p>An <a class="reference external" href="https://gateway-api.sigs.k8s.io/concepts/api-overview/#httproute">HTTPRoute</a> resource corresponds to an Envoy proxy <a class="reference external" href="https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/route/v3/route_components.proto#envoy-v3-api-msg-config-route-v3-route">Route</a>.</p>
<ul>
<li><p>Each <a class="reference external" href="https://gateway-api.sigs.k8s.io/v1alpha2/api-types/httproute/#backendrefs-optional">backendRef</a> corresponds to an Envoy proxy <a class="reference external" href="https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/cluster/v3/cluster.proto#config-cluster-v3-cluster">Cluster</a>.</p></li>
</ul>
</li>
<li><p>The goal is to make Envoy Gateway components extensible in the future. See the <a class="reference internal" href="roadmap.html"><span class="doc std std-doc">roadmap</span></a> for additional details.</p></li>
</ul>
<p>The draft for this document is <a class="reference external" href="https://docs.google.com/document/d/1riyTPPYuvNzIhBdrAX8dpfxTmcobWZDSYTTB5NeybuY/edit">here</a>.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Envoy Gateway</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/compatibility.html">Compatibility Matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_docs.html">User Guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../design_docs.html">Design Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_docs.html">Developer Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about_docs.html">About the Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_involved.html">Getting Involved</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../design_docs.html">Design Docs</a><ul>
      <li>Previous: <a href="../design_docs.html" title="previous chapter">Design Docs</a></li>
      <li>Next: <a href="gatewayapi-translator.html" title="next chapter">Gateway API Translator Design</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;Envoy Gateway Project Authors | <a href="https://github.com/envoyproxy/gateway">GitHub</a> | <a href="/latest">Latest Docs</a>.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../_sources/design/system-design.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>