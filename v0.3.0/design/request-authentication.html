
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Request Authentication &#8212; Envoy Gateway  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Developer Docs" href="../dev_docs.html" />
    <link rel="prev" title="Rate Limit Design" href="ratelimit.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="request-authentication">
<h1>Request Authentication<a class="headerlink" href="#request-authentication" title="Permalink to this heading">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="https://github.com/envoyproxy/gateway/issues/336">Issue 336</a> specifies the need for exposing a user-facing API to configure request authentication. Request
authentication is defined as an authentication mechanism to be enforced by Envoy on a per-request basis. A connection
will be rejected if it contains invalid authentication information, based on the <code class="docutils literal notranslate"><span class="pre">AuthenticationFilter</span></code> API type
proposed in this design document.</p>
<p>Envoy Gateway leverages <a class="reference external" href="https://gateway-api.sigs.k8s.io/">Gateway API</a> for configuring managed Envoy proxies. Gateway API defines core, extended, and
implementation-specific API <a class="reference external" href="https://gateway-api.sigs.k8s.io/concepts/conformance/?h=extended#2-support-levels">support levels</a> for implementors such as Envoy Gateway to expose features. Since
implementing request authentication is not covered by <code class="docutils literal notranslate"><span class="pre">Core</span></code> or <code class="docutils literal notranslate"><span class="pre">Extended</span></code> APIs, an <code class="docutils literal notranslate"><span class="pre">Implementation-specific</span></code> API will
be created for this purpose.</p>
</section>
<section id="goals">
<h2>Goals<a class="headerlink" href="#goals" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Define an API for configuring request authentication.</p></li>
<li><p>Implement <a class="reference external" href="https://jwt.io/">JWT</a> as the first supported authentication type.</p></li>
<li><p>Allow users that manage routes, e.g. <a class="reference external" href="https://gateway-api.sigs.k8s.io/api-types/httproute/">HTTPRoute</a>, to authenticate matching requests before forwarding to a backend
service.</p></li>
<li><p>Support HTTPRoutes as an Authentication API referent. HTTPRoute provides multiple <a class="reference external" href="https://gateway-api.sigs.k8s.io/concepts/api-overview/?h=extension#extension-points">extension points</a>. The
<a class="reference external" href="https://gateway-api.sigs.k8s.io/references/spec/#gateway.networking.k8s.io/v1beta1.HTTPRouteFilter">HTTPRouteFilter</a> is the extension point supported by the Authentication API.</p></li>
</ul>
</section>
<section id="non-goals">
<h2>Non-Goals<a class="headerlink" href="#non-goals" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Allow infrastructure administrators to override or establish default authentication policies.</p></li>
<li><p>Support referents other than HTTPRoute.</p></li>
<li><p>Support Gateway API extension points other than HTTPRouteFilter.</p></li>
</ul>
</section>
<section id="use-cases">
<h2>Use-Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">¶</a></h2>
<p>These use-cases are presented as an aid for how users may attempt to utilize the outputs of the design. They are not an
exhaustive list of features for authentication support in Envoy Gateway.</p>
<p>As a Service Producer, I need the ability to:</p>
<ul class="simple">
<li><p>Authenticate a request before forwarding it to a backend service.</p></li>
<li><p>Have different authentication mechanisms per route rule.</p></li>
<li><p>Choose from different authentication mechanisms supported by Envoy, e.g. OIDC.</p></li>
</ul>
<section id="authentication-api-type">
<h3>Authentication API Type<a class="headerlink" href="#authentication-api-type" title="Permalink to this heading">¶</a></h3>
<p>The Authentication API type defines authentication configuration for authenticating requests through managed Envoy
proxies.</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">v1alpha1</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">	</span><span class="nx">metav1</span><span class="w"> </span><span class="s">&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>

<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">AuthenticationFilter</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="nx">metav1</span><span class="p">.</span><span class="nx">TypeMeta</span>
<span class="w">	</span><span class="nx">metav1</span><span class="p">.</span><span class="nx">ObjectMeta</span>

<span class="w">	</span><span class="c1">// Spec defines the desired state of the Authentication type.</span>
<span class="w">	</span><span class="nx">Spec</span><span class="w"> </span><span class="nx">AuthenticationFilterSpec</span>

<span class="w">	</span><span class="c1">// Note: The status sub-resource has been excluded but may be added in the future.</span>
<span class="p">}</span>

<span class="c1">// AuthenticationFilterSpec defines the desired state of the AuthenticationFilter type.</span>
<span class="c1">// +union</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">AuthenticationFilterSpec</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="c1">// Type defines the type of authentication provider to use. Supported provider types are:</span>
<span class="w">	</span><span class="c1">//</span>
<span class="w">	</span><span class="c1">// * JWT: A provider that uses JSON Web Token (JWT) for authenticating requests.</span>
<span class="w">	</span><span class="c1">//</span>
<span class="w">	</span><span class="c1">// +unionDiscriminator</span>
<span class="w">	</span><span class="nx">Type</span><span class="w"> </span><span class="nx">AuthenticationFilterType</span>

<span class="w">	</span><span class="c1">// JWT defines the JSON Web Token (JWT) authentication provider type. When multiple</span>
<span class="w">	</span><span class="c1">// jwtProviders are specified, the JWT is considered valid if any of the providers</span>
<span class="w">	</span><span class="c1">// successfully validate the JWT.</span>
<span class="w">	</span><span class="nx">JwtProviders</span><span class="w"> </span><span class="p">[]</span><span class="nx">JwtAuthenticationFilterProvider</span>
<span class="p">}</span>

<span class="o">...</span>
</pre></div>
</div>
<p>Refer to <a class="reference external" href="https://github.com/envoyproxy/gateway/pull/733">PR 773</a> for the detailed AuthenticationFilter API spec.</p>
<p>The status subresource is not included in the AuthenticationFilter API. Status will be surfaced by an HTTPRoute that
references an AuthenticationFilter. For example, an HTTPRoute will surface the <code class="docutils literal notranslate"><span class="pre">ResolvedRefs=False</span></code> status condition if it
references an AuthenticationFilter that does not exist. It may be beneficial to add AuthenticationFilter status fields in the future
based on defined use-cases. For example, a remote <a class="reference external" href="https://www.rfc-editor.org/rfc/rfc7517">JWKS</a> can be validated based on the specified URI and have an
appropriate status condition surfaced.</p>
<section id="authenticationfilter-example">
<h4>AuthenticationFilter Example<a class="headerlink" href="#authenticationfilter-example" title="Permalink to this heading">¶</a></h4>
<p>The following is an AuthenticationFilter example with one JWT authentication provider:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.envoyproxy.io/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AuthenticationFilter</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">JWT</span>
<span class="w">  </span><span class="nt">jwtProviders</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example</span>
<span class="w">    </span><span class="nt">issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://www.example.com</span>
<span class="w">    </span><span class="nt">audiences</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo.com</span>
<span class="w">    </span><span class="nt">remoteJwks</span><span class="p">:</span>
<span class="w">      </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://foo.com/jwt/public-key/jwks.json</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">&lt;TBD&gt;</span>
</pre></div>
</div>
<p><strong>Note:</strong> <code class="docutils literal notranslate"><span class="pre">type</span></code> is a union type, allowing only one of any supported provider type such as <code class="docutils literal notranslate"><span class="pre">jwtProviders</span></code> to be
specified.</p>
<p>The following is an example HTTPRoute configured to use the above JWT authentication provider:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.networking.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTPRoute</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">parentRefs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eg</span>
<span class="w">  </span><span class="nt">hostnames</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www.example.com</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">matches</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PathPrefix</span>
<span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/foo</span>
<span class="w">      </span><span class="nt">filters</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ExtensionRef</span>
<span class="w">          </span><span class="nt">extensionRef</span><span class="p">:</span>
<span class="w">            </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.envoyproxy.io</span>
<span class="w">            </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AuthenticationFilter</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example</span>
<span class="w">      </span><span class="nt">backendRefs</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3000</span>
</pre></div>
</div>
<p>Requests for <code class="docutils literal notranslate"><span class="pre">www.example.com/foo</span></code> will be authenticated using the referenced JWT provider before being forwarded to the
backend service named “backend”.</p>
</section>
</section>
</section>
<section id="implementation-details">
<h2>Implementation Details<a class="headerlink" href="#implementation-details" title="Permalink to this heading">¶</a></h2>
<p>The JWT authentication type is translated to an Envoy <a class="reference external" href="https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/jwt_authn_filter#config-http-filters-jwt-authn">JWT authentication filter</a> and a cluster is created for each
remote <a class="reference external" href="https://www.rfc-editor.org/rfc/rfc7517">JWKS</a>. The following examples provide additional details on how Gateway API and AuthenticationFilter resources are
translated into Envoy configuration.</p>
<section id="example-1-one-route-with-one-jwt-provider">
<h3>Example 1: One Route with One JWT Provider<a class="headerlink" href="#example-1-one-route-with-one-jwt-provider" title="Permalink to this heading">¶</a></h3>
<p>The following cluster is created from the above HTTPRoute and AuthenticationFilter:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">dynamic_clusters</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo.com|443</span>
<span class="w">    </span><span class="nt">load_assignment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">cluster_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo.com|443</span>
<span class="w">      </span><span class="nt">endpoints</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">lb_endpoints</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">endpoint</span><span class="p">:</span>
<span class="w">                </span><span class="nt">address</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">socket_address</span><span class="p">:</span>
<span class="w">                    </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo.com</span>
<span class="w">                    </span><span class="nt">port_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">    </span><span class="nt">transport_socket</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.transport_sockets.tls</span>
<span class="w">      </span><span class="nt">typed_config</span><span class="p">:</span>
<span class="w">        </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.transport_sockets.tls.v3.UpstreamTlsContext</span>
<span class="w">        </span><span class="nt">sni</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo.com</span>
<span class="w">        </span><span class="nt">common_tls_context</span><span class="p">:</span>
<span class="w">          </span><span class="nt">validation_context</span><span class="p">:</span>
<span class="w">            </span><span class="nt">match_subject_alt_names</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">exact</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;*.foo.com&quot;</span>
<span class="w">            </span><span class="nt">trusted_ca</span><span class="p">:</span>
<span class="w">              </span><span class="nt">filename</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ssl/certs/ca-certificates.crt</span>
</pre></div>
</div>
<p>A JWT authentication HTTP filter is added to the HTTP Connection Manager. For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">dynamic_resources</span><span class="p">:</span>
<span class="w">  </span><span class="nt">dynamic_listeners</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example_listener</span>
<span class="w">      </span><span class="nt">address</span><span class="p">:</span>
<span class="w">        </span><span class="nt">socket_address</span><span class="p">:</span>
<span class="w">          </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.2.3.4</span>
<span class="w">          </span><span class="nt">port_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">      </span><span class="nt">filter_chains</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">filters</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.http_connection_manager</span>
<span class="w">          </span><span class="nt">http_filters</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.filters.http.jwt_authn</span>
<span class="w">            </span><span class="nt">typed_config</span><span class="p">:</span>
<span class="w">              </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.config.filter.http.jwt_authn.v2alpha.JwtAuthentication</span>
</pre></div>
</div>
<p>This JWT authentication HTTP filter contains two fields:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">providers</span></code> field specifies how a JWT should be verified, such as where to extract the token, where to fetch the
public key (<a class="reference external" href="https://www.rfc-editor.org/rfc/rfc7517">JWKS</a>) and where to output its payload. This field is built from the source resource <code class="docutils literal notranslate"><span class="pre">namespace-name</span></code>, and
the JWT provider name of an AuthenticationFilter.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">rules</span></code> field specifies matching rules and their requirements. If a request matches a rule, its requirement
applies. The requirement specifies which JWT providers should be used. This field is built from a HTTPRoute
<code class="docutils literal notranslate"><span class="pre">matches</span></code> rule that references the AuthenticationFilter. When a referenced Authentication specifies multiple
<code class="docutils literal notranslate"><span class="pre">jwtProviders</span></code>, the JWT is considered valid if <strong>any</strong> of the providers successfully validate the JWT.</p></li>
</ul>
<p>The following JWT authentication HTTP filter <code class="docutils literal notranslate"><span class="pre">providers</span></code> configuration is created from the above AuthenticationFilter.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">providers</span><span class="p">:</span>
<span class="w">   </span><span class="nt">example</span><span class="p">:</span>
<span class="w">     </span><span class="nt">issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://www.example.com</span>
<span class="w">     </span><span class="nt">audiences</span><span class="p">:</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo.com</span>
<span class="w">     </span><span class="nt">remote_jwks</span><span class="p">:</span>
<span class="w">       </span><span class="nt">http_uri</span><span class="p">:</span>
<span class="w">         </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://foo.com/jwt/public-key/jwks.json</span>
<span class="w">         </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example_jwks_cluster</span>
<span class="w">         </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1s</span>
</pre></div>
</div>
<p>The following JWT authentication HTTP filter <code class="docutils literal notranslate"><span class="pre">rules</span></code> configuration is created from the above HTTPRoute.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">match</span><span class="p">:</span>
<span class="w">      </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/foo</span>
<span class="w">    </span><span class="nt">requires</span><span class="p">:</span>
<span class="w">      </span><span class="nt">provider_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-example-example</span>
</pre></div>
</div>
</section>
<section id="example-2-two-httproutes-with-different-authenticationfilters">
<h3>Example 2: Two HTTPRoutes with Different AuthenticationFilters<a class="headerlink" href="#example-2-two-httproutes-with-different-authenticationfilters" title="Permalink to this heading">¶</a></h3>
<p>The following example contains:</p>
<ul class="simple">
<li><p>Two HTTPRoutes with different hostnames.</p></li>
<li><p>Each HTTPRoute references a different AuthenticationFilter.</p></li>
<li><p>Each AuthenticationFilter contains a different JWT provider.</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.envoyproxy.io/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AuthenticationFilter</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example1</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">JWT</span>
<span class="w">  </span><span class="nt">jwtProviders</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example1</span>
<span class="w">    </span><span class="nt">issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://www.example1.com</span>
<span class="w">    </span><span class="nt">audiences</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo.com</span>
<span class="w">    </span><span class="nt">remoteJwks</span><span class="p">:</span>
<span class="w">      </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://foo.com/jwt/public-key/jwks.json</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.envoyproxy.io/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AuthenticationFilter</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example2</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">JWT</span>
<span class="w">  </span><span class="nt">jwtProviders</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example2</span>
<span class="w">      </span><span class="nt">issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://www.example2.com</span>
<span class="w">      </span><span class="nt">audiences</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bar.com</span>
<span class="w">      </span><span class="nt">remoteJwks</span><span class="p">:</span>
<span class="w">        </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://bar.com/jwt/public-key/jwks.json</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.networking.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTPRoute</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example1</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">hostnames</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www.example1.com</span>
<span class="w">  </span><span class="nt">parentRefs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.networking.k8s.io</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Gateway</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eg</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">matches</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PathPrefix</span>
<span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/foo</span>
<span class="w">      </span><span class="nt">filters</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ExtensionRef</span>
<span class="w">          </span><span class="nt">extensionRef</span><span class="p">:</span>
<span class="w">            </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.envoyproxy.io</span>
<span class="w">            </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AuthenticationFilter</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example1</span>
<span class="w">      </span><span class="nt">backendRefs</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3000</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.networking.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTPRoute</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example2</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">hostnames</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www.example2.com</span>
<span class="w">  </span><span class="nt">parentRefs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.networking.k8s.io</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Gateway</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eg</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">matches</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PathPrefix</span>
<span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/bar</span>
<span class="w">      </span><span class="nt">filters</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ExtensionRef</span>
<span class="w">          </span><span class="nt">extensionRef</span><span class="p">:</span>
<span class="w">            </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.envoyproxy.io</span>
<span class="w">            </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AuthenticationFilter</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example2</span>
<span class="w">      </span><span class="nt">backendRefs</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend2</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3000</span>
</pre></div>
</div>
<p>The following xDS configuration is created from the above example resources:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">configs</span><span class="p">:</span>
<span class="nn">...</span>
<span class="nt">dynamic_listeners</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-eg-http</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">default_filter_chain</span><span class="p p-Indicator">:</span>
<span class="w">          </span><span class="nt">filters</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.filters.network.http_connection_manager</span>
<span class="w">            </span><span class="nt">typed_config</span><span class="p">:</span>
<span class="w">              </span><span class="s">&#39;@type&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">&gt;-</span>
<span class="w">                </span><span class="no">type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager</span>
<span class="w">              </span><span class="nt">stat_prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<span class="w">              </span><span class="nt">rds</span><span class="p">:</span>
<span class="w">                </span><span class="nt">config_source</span><span class="p">:</span>
<span class="w">                  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">                </span><span class="nt">route_config_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-eg-http</span>
<span class="w">              </span><span class="nt">http_filters</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.filters.http.jwt_authn</span>
<span class="w">                  </span><span class="nt">typed_config</span><span class="p">:</span>
<span class="w">                    </span><span class="s">&#39;@type&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">&gt;-</span>
<span class="w">                      </span><span class="no">type.googleapis.com/envoy.config.filter.http.jwt_authn.v2alpha.JwtAuthentication</span>
<span class="w">                    </span><span class="nt">providers</span><span class="p">:</span>
<span class="w">                      </span><span class="nt">default-example1-example1</span><span class="p">:</span>
<span class="w">                        </span><span class="nt">issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://www.example1.com</span>
<span class="w">                        </span><span class="nt">audiences</span><span class="p">:</span>
<span class="w">                          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo.com</span>
<span class="w">                        </span><span class="nt">remote_jwks</span><span class="p">:</span>
<span class="w">                          </span><span class="nt">http_uri</span><span class="p">:</span>
<span class="w">                            </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://foo.com/jwt/public-key/jwks.json</span>
<span class="w">                            </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-example1-example1-jwt</span>
<span class="w">                      </span><span class="nt">default-example2-example2</span><span class="p">:</span>
<span class="w">                        </span><span class="nt">issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://www.example2.com</span>
<span class="w">                        </span><span class="nt">audiences</span><span class="p">:</span>
<span class="w">                          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bar.com</span>
<span class="w">                        </span><span class="nt">remote_jwks</span><span class="p">:</span>
<span class="w">                          </span><span class="nt">http_uri</span><span class="p">:</span>
<span class="w">                            </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://bar.com/jwt/public-key/jwks.json</span>
<span class="w">                            </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-example2-example2-jwt</span>
<span class="w">                    </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">                      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">match</span><span class="p">:</span>
<span class="w">                          </span><span class="nt">exact</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/foo</span>
<span class="w">                        </span><span class="nt">requires</span><span class="p">:</span>
<span class="w">                          </span><span class="nt">provider_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-example1-example1</span>
<span class="w">                      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">match</span><span class="p">:</span>
<span class="w">                          </span><span class="nt">exact</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/bar</span>
<span class="w">                        </span><span class="nt">requires</span><span class="p">:</span>
<span class="w">                          </span><span class="nt">provider_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-example2-example2</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.filters.http.router</span>
<span class="w">                  </span><span class="nt">typed_config</span><span class="p">:</span>
<span class="w">                    </span><span class="s">&#39;@type&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">&gt;-</span>
<span class="w">                      </span><span class="no">type.googleapis.com/envoy.extensions.filters.http.router.v3.Router</span>
<span class="nt">dynamic_route_configs</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">route_config</span><span class="p">:</span>
<span class="w">      </span><span class="s">&#39;@type&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.config.route.v3.RouteConfiguration</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-eg-http</span>
<span class="w">      </span><span class="nt">virtual_hosts</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-eg-http</span>
<span class="w">          </span><span class="nt">domains</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;*&#39;</span>
<span class="w">          </span><span class="nt">routes</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">match</span><span class="p">:</span>
<span class="w">                </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/foo</span>
<span class="w">                </span><span class="nt">headers</span><span class="p">:</span>
<span class="w">                  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;:authority&#39;</span>
<span class="w">                    </span><span class="nt">string_match</span><span class="p">:</span>
<span class="w">                      </span><span class="nt">exact</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www.example1.com</span>
<span class="w">              </span><span class="nt">route</span><span class="p">:</span>
<span class="w">                </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-backend-rule-0-match-0-www.example1.com</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">match</span><span class="p">:</span>
<span class="w">                </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/bar</span>
<span class="w">                </span><span class="nt">headers</span><span class="p">:</span>
<span class="w">                  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;:authority&#39;</span>
<span class="w">                    </span><span class="nt">string_match</span><span class="p">:</span>
<span class="w">                      </span><span class="nt">exact</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www.example2.com</span>
<span class="w">              </span><span class="nt">route</span><span class="p">:</span>
<span class="w">                </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-backend2-rule-0-match-0-www.example2.com</span>
<span class="nt">dynamic_active_clusters</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cluster</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-backend-rule-0-match-0-www.example.com</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">endpoints</span><span class="p p-Indicator">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">locality</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">          </span><span class="nt">lb_endpoints</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">endpoint</span><span class="p">:</span>
<span class="w">                </span><span class="nt">address</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">socket_address</span><span class="p">:</span>
<span class="w">                    </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$BACKEND_SERVICE1_IP</span>
<span class="w">                    </span><span class="nt">port_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3000</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cluster</span><span class="p">:</span>
<span class="w">      </span><span class="s">&#39;@type&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.config.cluster.v3.Cluster</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-backend-rule-1-match-0-www.example.com</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">endpoints</span><span class="p p-Indicator">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">locality</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">          </span><span class="nt">lb_endpoints</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">endpoint</span><span class="p">:</span>
<span class="w">                </span><span class="nt">address</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">socket_address</span><span class="p">:</span>
<span class="w">                    </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$BACKEND_SERVICE2_IP</span>
<span class="w">                    </span><span class="nt">port_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3000</span>
<span class="nn">...</span>
</pre></div>
</div>
<p><strong>Note:</strong> The JWT provider cluster and route is omitted from the above example for brevity.</p>
</section>
<section id="implementation-outline">
<h3>Implementation Outline<a class="headerlink" href="#implementation-outline" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Update the Kubernetes provider to get/watch AuthenticationFilter resources that are referenced by managed HTTPRoutes.
Add the referenced AuthenticationFilter object to the resource map and publish it.</p></li>
<li><p>Update the resource translator to include the AuthenticationFilter API in HTTPRoute processing.</p></li>
<li><p>Update the xDS translator to translate an AuthenticationFilter into xDS resources. The translator should perform the
following:</p>
<ul>
<li><p>Convert a list of JWT rules from the xds IR into an Envoy JWT filter config.</p></li>
<li><p>Create a JWT authentication HTTP filter.</p></li>
<li><p>Build the HTTP Connection Manager (HCM) HTTP filters.</p></li>
<li><p>Build the HCM.</p></li>
<li><p>When building the Listener, create an HCM for each filter-chain.</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="adding-authentication-types">
<h2>Adding Authentication Types<a class="headerlink" href="#adding-authentication-types" title="Permalink to this heading">¶</a></h2>
<p>Additional authentication types can be added in the future through the <code class="docutils literal notranslate"><span class="pre">AuthenticationFilterType</span></code> API. For
example, to add the <code class="docutils literal notranslate"><span class="pre">Foo</span></code> authentication type:</p>
<p>Define the <code class="docutils literal notranslate"><span class="pre">Foo</span></code> authentication provider:</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">v1alpha1</span>

<span class="c1">// FooAuthenticationFilterProvider defines the &quot;Foo&quot; authentication filter provider type.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">FooAuthenticationFilterProvider</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="c1">// TODO: Define fields of the Foo authentication filter provider type.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Add the <code class="docutils literal notranslate"><span class="pre">FooAuthenticationFilterProvider</span></code> type to <code class="docutils literal notranslate"><span class="pre">AuthenticationFilterSpec</span></code>:</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">v1alpha1</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">AuthenticationFilterSpec</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="o">...</span>
<span class="w">	</span>
<span class="w">	</span><span class="c1">// Foo defines the Foo authentication type. For additional</span>
<span class="w">	</span><span class="c1">// details, see:</span>
<span class="w">	</span><span class="c1">//</span>
<span class="w">	</span><span class="c1">//   &lt;INSERT_LINK&gt;</span>
<span class="w">	</span><span class="c1">//</span>
<span class="w">	</span><span class="c1">// +optional</span>
<span class="w">	</span><span class="nx">Foo</span><span class="w"> </span><span class="o">*</span><span class="nx">FooAuthenticationFilterProvider</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Lastly, add the type to the <code class="docutils literal notranslate"><span class="pre">AuthenticationType</span></code> enum:</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// AuthenticationType is a type of authentication provider.</span>
<span class="c1">// +kubebuilder:validation:Enum=JWT,FOO</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">AuthenticationFilterType</span><span class="w"> </span><span class="kt">string</span>

<span class="kd">const</span><span class="w"> </span><span class="p">(</span>
<span class="w">	</span><span class="c1">// JwtAuthenticationProviderType is the JWT authentication provider type.</span>
<span class="w">	</span><span class="nx">FooAuthenticationFilterProviderType</span><span class="w"> </span><span class="nx">AuthenticationFilterType</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;FOO&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The AuthenticationFilter API should support additional authentication types in the future, for example:</p>
<ul class="simple">
<li><p>OAuth2</p></li>
<li><p>OIDC</p></li>
</ul>
</section>
<section id="outstanding-questions">
<h2>Outstanding Questions<a class="headerlink" href="#outstanding-questions" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>If Envoy Gateway owns the AuthenticationFilter API, is an xDS IR equivalent needed?</p></li>
<li><p>Should local <a class="reference external" href="https://www.rfc-editor.org/rfc/rfc7517">JWKS</a> be implemented before remote <a class="reference external" href="https://www.rfc-editor.org/rfc/rfc7517">JWKS</a>?</p></li>
<li><p>How should Envoy obtain the trusted CA for a remote <a class="reference external" href="https://www.rfc-editor.org/rfc/rfc7517">JWKS</a>?</p></li>
<li><p>Should HTTPS be the only supported scheme for remote <a class="reference external" href="https://www.rfc-editor.org/rfc/rfc7517">JWKS</a>?</p></li>
<li><p>Should OR’ing JWT providers be supported?</p></li>
<li><p>Should Authentication provide status?</p></li>
<li><p>Are the API field validation rules acceptable?</p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Envoy Gateway</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/compatibility.html">Compatibility Matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_docs.html">User Guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../design_docs.html">Design Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_docs.html">Developer Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_docs.html">API Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about_docs.html">About the Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_involved.html">Getting Involved</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../design_docs.html">Design Docs</a><ul>
      <li>Previous: <a href="ratelimit.html" title="previous chapter">Rate Limit Design</a></li>
      <li>Next: <a href="../dev_docs.html" title="next chapter">Developer Docs</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;Envoy Gateway Project Authors | <a href="https://github.com/envoyproxy/gateway">GitHub</a> | <a href="/latest">Latest Docs</a>.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../_sources/design/request-authentication.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>