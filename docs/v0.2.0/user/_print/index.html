<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.117.0"><link rel=canonical type=text/html href=http://gateway.xunzhuo.cafe/docs/v0.2.0/user/><link rel=alternate type=application/rss+xml href=http://gateway.xunzhuo.cafe/docs/v0.2.0/user/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>User Guide | Envoy Gateway</title><meta name=description content="This section includes User Guides of Envoy Gateway."><meta property="og:title" content="User Guide"><meta property="og:description" content="This section includes User Guides of Envoy Gateway."><meta property="og:type" content="website"><meta property="og:url" content="http://gateway.xunzhuo.cafe/docs/v0.2.0/user/"><meta property="og:site_name" content="Envoy Gateway"><meta itemprop=name content="User Guide"><meta itemprop=description content="This section includes User Guides of Envoy Gateway."><meta name=twitter:card content="summary"><meta name=twitter:title content="User Guide"><meta name=twitter:description content="This section includes User Guides of Envoy Gateway."><link rel=preload href=/scss/main.min.291c723daa8f2fb6b09f56ac9a2ca71406607a4268e1fe586dddad1a8583b4e7.css as=style><link href=/scss/main.min.291c723daa8f2fb6b09f56ac9a2ca71406607a4268e1fe586dddad1a8583b4e7.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.3.min.js integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-00000000-0"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-00000000-0")}</script></head><body class=td-section><header><nav class="td-navbar navbar-dark js-navbar-scroll"><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class=navbar-brand__name>Envoy Gateway</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/about/><span>About</span></a></li><li class=nav-item><a class=nav-link href=/blog/><span>Blog</span></a></li><li class=nav-item><a class=nav-link href=/community/><span>Community</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Releases</a><ul class=dropdown-menu><li><a class=dropdown-item href=/docs/latest>latest</a></li><li><a class=dropdown-item href=/docs/v0.5.0>v0.5.0</a></li><li><a class=dropdown-item href=/docs/v0.4.0>v0.4.0</a></li><li><a class=dropdown-item href=/docs/v0.3.0>v0.3.0</a></li><li><a class=dropdown-item href=/docs/v0.2.0>v0.2.0</a></li></ul></div></li></ul></div><div class="d-none d-lg-block"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/v0.2.0/user/>Return to the regular view of this page</a>.</p></div><h1 class=title>User Guide</h1><div class=lead>This section includes User Guides of Envoy Gateway.</div><ul><li>1: <a href=#pg-c0bd6c3efbd8430dd068fc571af7eb69>Quickstart</a></li><li>2: <a href=#pg-529c7a66eaad2a6ebad988d93c3704b0>HTTP Redirects</a></li><li>3: <a href=#pg-6e5b071c3958a2185c5ba9ddc07de387>HTTP Request Headers</a></li><li>4: <a href=#pg-e48d82e7939cdd61cd8e6ffd2241a076>HTTP Routing</a></li><li>5: <a href=#pg-c1cabbd3cbd8653e1244e261cf3b50d1>HTTPRoute Traffic Splitting</a></li><li>6: <a href=#pg-2ea9b8e571f196c8677b198dcbe4720f>Secure Gateways</a></li><li>7: <a href=#pg-841e8473f143ae200856727279a10455>TLS Passthrough</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-c0bd6c3efbd8430dd068fc571af7eb69>1 - Quickstart</h1><p>This guide will help you get started with Envoy Gateway in a few simple steps.</p><h2 id=prerequisites>Prerequisites</h2><p>A Kubernetes cluster.</p><p><strong>Note:</strong> Refer to the <a href=../intro/compatibility.rst>Compatibility Matrix</a> for supported Kubernetes versions.</p><h2 id=installation>Installation</h2><p>Install the Gateway API CRDs and Envoy Gateway:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://github.com/envoyproxy/gateway/releases/download/v0.2.0/install.yaml
</span></span></code></pre></div><p>Wait for Envoy Gateway to become available:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#204a87>wait</span> --timeout<span style=color:#ce5c00;font-weight:700>=</span>5m -n envoy-gateway-system deployment/envoy-gateway --for<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>condition</span><span style=color:#ce5c00;font-weight:700>=</span>Available
</span></span></code></pre></div><p>Install the GatewayClass, Gateway, HTTPRoute and example app:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://github.com/envoyproxy/gateway/releases/download/v0.2.0/quickstart.yaml
</span></span></code></pre></div><h2 id=testing-the-configuration>Testing the Configuration</h2><p>Get the name of the Envoy service created the by the example Gateway:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>ENVOY_SERVICE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>kubectl get svc -n envoy-gateway-system --selector<span style=color:#ce5c00;font-weight:700>=</span>gateway.envoyproxy.io/owning-gateway-namespace<span style=color:#ce5c00;font-weight:700>=</span>default,gateway.envoyproxy.io/owning-gateway-name<span style=color:#ce5c00;font-weight:700>=</span>eg -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.items[0].metadata.name}&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span></code></pre></div><p>Port forward to the Envoy service:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl -n envoy-gateway-system port-forward service/<span style=color:#4e9a06>${</span><span style=color:#000>ENVOY_SERVICE</span><span style=color:#4e9a06>}</span> 8888:8080 <span style=color:#000;font-weight:700>&amp;</span>
</span></span></code></pre></div><p>Curl the example app through Envoy proxy:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl --verbose --header <span style=color:#4e9a06>&#34;Host: www.example.com&#34;</span> http://localhost:8888/get
</span></span></code></pre></div><h3 id=external-loadbalancer-support>External LoadBalancer Support</h3><p>You can also test the same functionality by sending traffic to the External IP. To get the external IP of the
Envoy service, run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>GATEWAY_HOST</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>kubectl get svc/<span style=color:#4e9a06>${</span><span style=color:#000>ENVOY_SERVICE</span><span style=color:#4e9a06>}</span> -n envoy-gateway-system -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.status.loadBalancer.ingress[0].ip}&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span></code></pre></div><p>In certain environments, the load balancer may be exposed using a hostname, instead of an IP address. If so, replace
<code>ip</code> in the above command with <code>hostname</code>.</p><p>Curl the example app through Envoy proxy:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl --verbose --header <span style=color:#4e9a06>&#34;Host: www.example.com&#34;</span> http://<span style=color:#000>$GATEWAY_HOST</span>:8080/get
</span></span></code></pre></div><h2 id=clean-up>Clean-Up</h2><p>Use the steps in this section to uninstall everything from the quickstart guide.</p><p>Delete the GatewayClass, Gateway, HTTPRoute and Example App:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete -f https://github.com/envoyproxy/gateway/releases/download/v0.2.0/quickstart.yaml --ignore-not-found<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>
</span></span></code></pre></div><p>Delete the Gateway API CRDs and Envoy Gateway:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete -f https://github.com/envoyproxy/gateway/releases/download/v0.2.0/install.yaml --ignore-not-found<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>
</span></span></code></pre></div><h2 id=next-steps>Next Steps</h2><p>Checkout the <a href=../dev/README.md>Developer Guide</a> to get involved in the project.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-529c7a66eaad2a6ebad988d93c3704b0>2 - HTTP Redirects</h1><p>The <a href=https://gateway-api.sigs.k8s.io/api-types/httproute/>HTTPRoute</a> resource can issue redirects to clients or rewrite paths sent upstream using filters. Note that
HTTPRoute rules cannot use both filter types at once. Currently, Envoy Gateway only supports <strong>core</strong>
<a href=https://gateway-api.sigs.k8s.io/references/spec/#gateway.networking.k8s.io/v1beta1.HTTPRouteFilter>HTTPRoute filters</a> which consist of <code>RequestRedirect</code> and <code>RequestHeaderModifier</code> at the time of this writing. To
learn more about HTTP routing, refer to the <a href=https://gateway-api.sigs.k8s.io/>Gateway API documentation</a>.</p><h2 id=prerequisites>Prerequisites</h2><p>Follow the steps from the <a href=secure-gateways.md>Secure Gateways</a> to install Envoy Gateway and the example manifest.
Before proceeding, you should be able to query the example backend using HTTPS.</p><h2 id=redirects>Redirects</h2><p>Redirects return HTTP 3XX responses to a client, instructing it to retrieve a different resource. A
<a href=https://gateway-api.sigs.k8s.io/references/spec/#gateway.networking.k8s.io/v1beta1.HTTPRequestRedirectFilter><code>RequestRedirect</code> filter</a> instructs Gateways to emit a redirect response to requests that match the rule.
For example, to issue a permanent redirect (301) from HTTP to HTTPS, configure <code>requestRedirect.statusCode=301</code> and
<code>requestRedirect.scheme="https"</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: gateway.networking.k8s.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: HTTPRoute
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: http-to-https-filter-redirect
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  parentRefs:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - name: eg
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  hostnames:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - redirect.example
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  rules:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - filters:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      - type: RequestRedirect
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        requestRedirect:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          scheme: https
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          statusCode: 301
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          hostname: www.example.com
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          port: 8443
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      backendRefs:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      - name: backend
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        port: 3000
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p><strong>Note:</strong> <code>301</code> (default) and <code>302</code> are the only supported statusCodes.</p><p>The HTTPRoute status should indicate that it has been accepted and is bound to the example Gateway.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get httproute/http-to-https-filter-redirect -o yaml
</span></span></code></pre></div><p>Get the Gateway&rsquo;s address:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>GATEWAY_HOST</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>kubectl get gateway/eg -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.status.addresses[0].value}&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span></code></pre></div><p>Querying <code>redirect.example/get</code> should result in a <code>301</code> response from the example Gateway and redirecting to the
configured redirect hostname.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> curl -L -vvv --header <span style=color:#4e9a06>&#34;Host: redirect.example&#34;</span> <span style=color:#4e9a06>&#34;http://</span><span style=color:#4e9a06>${</span><span style=color:#000>GATEWAY_HOST</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>:8080/get&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>...
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; HTTP/1.1 301 Moved Permanently
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; location: https://www.example.com:8443/get
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>...
</span></span></span></code></pre></div><p>If you followed the steps in the <a href=secure-gateways.md>Secure Gateways</a> guide, you should be able to curl the redirect
location.</p><h2 id=path-redirects>Path Redirects</h2><p>Path redirects use an HTTP Path Modifier to replace either entire paths or path prefixes. For example, the HTTPRoute
below will issue a 302 redirect to all <code>path.redirect.example</code> requests whose path begins with <code>/get</code> to <code>/status/200</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: gateway.networking.k8s.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: HTTPRoute
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: http-filter-path-redirect
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  parentRefs:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - name: eg
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  hostnames:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - path.redirect.example
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  rules:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - matches:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      - path:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          type: PathPrefix
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          value: /get
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      filters:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      - type: RequestRedirect
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        requestRedirect:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          path:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            type: ReplaceFullPath
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            replaceFullPath: /status/200
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          statusCode: 302
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      backendRefs:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      - name: backend
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        port: 3000
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p>The HTTPRoute status should indicate that it has been accepted and is bound to the example Gateway.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get httproute/http-filter-path-redirect -o yaml
</span></span></code></pre></div><p>Querying <code>path.redirect.example</code> should result in a <code>302</code> response from the example Gateway and a redirect location
containing the configured redirect path.</p><p>Query the <code>path.redirect.example</code> host:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -vvv --header <span style=color:#4e9a06>&#34;Host: path.redirect.example&#34;</span> <span style=color:#4e9a06>&#34;http://</span><span style=color:#4e9a06>${</span><span style=color:#000>GATEWAY_HOST</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>:8080/get&#34;</span>
</span></span></code></pre></div><p>You should receive a <code>302</code> with a redirect location of <code>http://path.redirect.example/status/200</code>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-6e5b071c3958a2185c5ba9ddc07de387>3 - HTTP Request Headers</h1><p>The <a href=https://gateway-api.sigs.k8s.io/api-types/httproute/>HTTPRoute</a> resource can modify the headers of a request before forwarding it to the upstream service. HTTPRoute
rules cannot use both filter types at once. Currently, Envoy Gateway only supports <strong>core</strong> <a href=https://gateway-api.sigs.k8s.io/references/spec/#gateway.networking.k8s.io/v1beta1.HTTPRouteFilter>HTTPRoute filters</a> which
consist of <code>RequestRedirect</code> and <code>RequestHeaderModifier</code> at the time of this writing. To learn more about HTTP routing,
refer to the <a href=https://gateway-api.sigs.k8s.io/>Gateway API documentation</a>.</p><p>A <a href=https://gateway-api.sigs.k8s.io/references/spec/#gateway.networking.k8s.io/v1beta1.HTTPHeaderFilter><code>RequestHeaderModifier</code> filter</a> instructs Gateways to modify the headers in requests that match the rule
before forwarding the request upstream. Note that the <code>RequestHeaderModifier</code> filter will only modify headers before the
request is sent from Envoy to the upstream service and will not affect response headers returned to the downstream
client.</p><h2 id=prerequisites>Prerequisites</h2><p>Follow the steps from the <a href=quickstart.md>Quickstart Guide</a> to install Envoy Gateway and the example manifest.
Before proceeding, you should be able to query the example backend using HTTP.</p><h2 id=adding-request-headers>Adding Request Headers</h2><p>The <code>RequestHeaderModifier</code> filter can add new headers to a request before it is sent to the upstream. If the request
does not have the header configured by the filter, then that header will be added to the request. If the request already
has the header configured by the filter, then the value of the header in the filter will be appended to the value of the
header in the request.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: gateway.networking.k8s.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: HTTPRoute
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: http-headers
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  parentRefs:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - name: eg
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  hostnames:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - headers.example
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  rules:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - matches:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - path:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        type: PathPrefix
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        value: /
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    backendRefs:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      kind: Service
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      name: backend
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      port: 3000
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      weight: 1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    filters:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - type: RequestHeaderModifier
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      requestHeaderModifier:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        add:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        - name: &#34;add-header&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          value: &#34;foo&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p>The HTTPRoute status should indicate that it has been accepted and is bound to the example Gateway.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get httproute/http-headers -o yaml
</span></span></code></pre></div><p>Get the Gateway&rsquo;s address:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>GATEWAY_HOST</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>kubectl get gateway/eg -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.status.addresses[0].value}&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span></code></pre></div><p>Querying <code>headers.example/get</code> should result in a <code>200</code> response from the example Gateway and the output from the
example app should indicate that the upstream example app received the header <code>add-header</code> with the value:
<code>something,foo</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> curl -vvv --header <span style=color:#4e9a06>&#34;Host: headers.example&#34;</span> <span style=color:#4e9a06>&#34;http://</span><span style=color:#4e9a06>${</span><span style=color:#000>GATEWAY_HOST</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>:8080/get&#34;</span> --header <span style=color:#4e9a06>&#34;add-header: something&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>...
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#8f5902>&gt;</span> GET /get HTTP/1.1
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> Host: headers.example
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> User-Agent: curl/7.81.0
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> Accept: */*
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> add-header: something
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> 
</span></span><span style=display:flex><span>* Mark bundle as not supporting multiuse
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; HTTP/1.1 200 OK
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; content-type: application/json
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; x-content-type-options: nosniff
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; content-length: 474
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; x-envoy-upstream-service-time: 0
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; server: envoy
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; 
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>...
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic> &#34;headers&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  &#34;Accept&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>   &#34;*/*&#34;
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  ],
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  &#34;Add-Header&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>   &#34;something&#34;,
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>   &#34;foo&#34;
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  ],
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>...
</span></span></span></code></pre></div><h2 id=setting-request-headers>Setting Request Headers</h2><p>Setting headers is similar to adding headers. If the request does not have the header configured by the filter, then it
will be added, but unlike <a href=#adding-request-headers>adding request headers</a> which will append the value of the header if
the request already contains it, setting a header will cause the value to be replaced by the value configured in the
filter.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: gateway.networking.k8s.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: HTTPRoute
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: http-headers
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  parentRefs:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - name: eg
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  hostnames:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - headers.example
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  rules:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - backendRefs:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      kind: Service
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      name: backend
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      port: 3000
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      weight: 1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    matches:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - path:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        type: PathPrefix
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        value: /
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    filters:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - type: RequestHeaderModifier
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      requestHeaderModifier:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        set:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        - name: &#34;set-header&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          value: &#34;foo&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p>Querying <code>headers.example/get</code> should result in a <code>200</code> response from the example Gateway and the output from the
example app should indicate that the upstream example app received the header <code>add-header</code> with the original value
<code>something</code> replaced by <code>foo</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> curl -vvv --header <span style=color:#4e9a06>&#34;Host: headers.example&#34;</span> <span style=color:#4e9a06>&#34;http://</span><span style=color:#4e9a06>${</span><span style=color:#000>GATEWAY_HOST</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>:8080/get&#34;</span> --header <span style=color:#4e9a06>&#34;set-header: something&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>...
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#8f5902>&gt;</span> GET /get HTTP/1.1
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> Host: headers.example
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> User-Agent: curl/7.81.0
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> Accept: */*
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> add-header: something
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> 
</span></span><span style=display:flex><span>* Mark bundle as not supporting multiuse
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; HTTP/1.1 200 OK
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; content-type: application/json
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; x-content-type-options: nosniff
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; content-length: 474
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; x-envoy-upstream-service-time: 0
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; server: envoy
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt;  
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic> &#34;headers&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  &#34;Accept&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>   &#34;*/*&#34;
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  ],
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  &#34;Set-Header&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>   &#34;foo&#34;
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  ],
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>...
</span></span></span></code></pre></div><h2 id=removing-request-headers>Removing Request Headers</h2><p>Headers can be removed from a request by simply supplying a list of header names.</p><p>Setting headers is similar to adding headers. If the request does not have the header configured by the filter, then it
will be added, but unlike <a href=#adding-request-headers>adding request headers</a> which will append the value of the header if
the request already contains it, setting a header will cause the value to be replaced by the value configured in the
filter.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: gateway.networking.k8s.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: HTTPRoute
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: http-headers
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  parentRefs:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - name: eg
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  hostnames:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - headers.example
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  rules:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - matches:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - path:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        type: PathPrefix
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        value: /
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    backendRefs:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      name: backend
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      port: 3000
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      weight: 1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    filters:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - type: RequestHeaderModifier
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      requestHeaderModifier:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        remove:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        - &#34;remove-header&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p>Querying <code>headers.example/get</code> should result in a <code>200</code> response from the example Gateway and the output from the
example app should indicate that the upstream example app received the header <code>add-header</code>, but the header
<code>remove-header</code> that was sent by curl was removed before the upstream received the request.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> curl -vvv --header <span style=color:#4e9a06>&#34;Host: headers.example&#34;</span> <span style=color:#4e9a06>&#34;http://</span><span style=color:#4e9a06>${</span><span style=color:#000>GATEWAY_HOST</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>:8080/get&#34;</span> --header <span style=color:#4e9a06>&#34;add-header: something&#34;</span> --header <span style=color:#4e9a06>&#34;remove-header: foo&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>...
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#8f5902>&gt;</span> GET /get HTTP/1.1
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> Host: headers.example
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> User-Agent: curl/7.81.0
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> Accept: */*
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> add-header: something
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> 
</span></span><span style=display:flex><span>* Mark bundle as not supporting multiuse
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; HTTP/1.1 200 OK
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; content-type: application/json
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; x-content-type-options: nosniff
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; content-length: 474
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; x-envoy-upstream-service-time: 0
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; server: envoy
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; 
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic> 
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic> &#34;headers&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  &#34;Accept&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>   &#34;*/*&#34;
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  ],
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  &#34;Add-Header&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>   &#34;something&#34;
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  ],
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>...
</span></span></span></code></pre></div><h2 id=combining-filters>Combining Filters</h2><p>Headers can be added/set/removed in a single filter on the same HTTPRoute and they will all perform as expected</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: gateway.networking.k8s.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: HTTPRoute
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: http-headers
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  parentRefs:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - name: eg
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  hostnames:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - headers.example
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  rules:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - matches:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - path:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        type: PathPrefix
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        value: /
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    backendRefs:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      kind: Service
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      name: backend
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      port: 3000
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      weight: 1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    filters:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - type: RequestHeaderModifier
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      requestHeaderModifier:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        add:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        - name: &#34;add-header-1&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          value: &#34;foo&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        set:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        - name: &#34;set-header-1&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          value: &#34;bar&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        remove:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        - &#34;removed-header&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-e48d82e7939cdd61cd8e6ffd2241a076>4 - HTTP Routing</h1><p>The <a href=https://gateway-api.sigs.k8s.io/api-types/httproute/>HTTPRoute</a> resource allows users to configure HTTP routing by matching HTTP traffic and forwarding it to
Kubernetes backends. Currently, the only supported backend supported by Envoy Gateway is a Service resource. This guide
shows how to route traffic based on host, header, and path fields and forward the traffic to different Kubernetes
Services. To learn more about HTTP routing, refer to the <a href=https://gateway-api.sigs.k8s.io/>Gateway API documentation</a>.</p><h2 id=prerequisites>Prerequisites</h2><p>Install Envoy Gateway:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://github.com/envoyproxy/gateway/releases/download/v0.2.0/install.yaml
</span></span></code></pre></div><p>Wait for Envoy Gateway to become available:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#204a87>wait</span> --timeout<span style=color:#ce5c00;font-weight:700>=</span>5m -n envoy-gateway-system deployment/envoy-gateway --for<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>condition</span><span style=color:#ce5c00;font-weight:700>=</span>Available
</span></span></code></pre></div><h2 id=installation>Installation</h2><p>Install the HTTP routing example resources:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://raw.githubusercontent.com/envoyproxy/gateway/v0.2.0/examples/kubernetes/http-routing.yaml
</span></span></code></pre></div><p>The manifest installs a <a href=https://gateway-api.sigs.k8s.io/api-types/gatewayclass/>GatewayClass</a>, <a href=https://gateway-api.sigs.k8s.io/api-types/gateway/>Gateway</a>, four Deployments, four Services, and three HTTPRoute resources.
The GatewayClass is a cluster-scoped resource that represents a class of Gateways that can be instantiated.</p><p><strong>Note:</strong> Envoy Gateway is configured by default to manage a GatewayClass with
<code>controllerName: gateway.envoyproxy.io/gatewayclass-controller</code>.</p><h2 id=verification>Verification</h2><p>Check the status of the GatewayClass:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get gc --selector<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>example</span><span style=color:#ce5c00;font-weight:700>=</span>http-routing
</span></span></code></pre></div><p>The status should reflect &ldquo;Accepted=True&rdquo;, indicating Envoy Gateway is managing the GatewayClass.</p><p>A Gateway represents configuration of infrastructure. When a Gateway is created, <a href=https://www.envoyproxy.io/>Envoy proxy</a> infrastructure is
provisioned or configured by Envoy Gateway. The <code>gatewayClassName</code> defines the name of a GatewayClass used by this
Gateway. Check the status of the Gateway:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get gateways --selector<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>example</span><span style=color:#ce5c00;font-weight:700>=</span>http-routing
</span></span></code></pre></div><p>The status should reflect &ldquo;Ready=True&rdquo;, indicating the Envoy proxy infrastructure has been provisioned. The status also
provides the address of the Gateway. This address is used later in the guide to test connectivity to proxied backend
services.</p><p>The three HTTPRoute resources create routing rules on the Gateway. In order to receive traffic from a Gateway,
an HTTPRoute must be configured with <code>parentRefs</code> which reference the parent Gateway(s) that it should be attached to.
An HTTPRoute can match against a <a href=https://gateway-api.sigs.k8s.io/references/spec/#gateway.networking.k8s.io/v1beta1.HTTPRouteSpec>single set of hostnames</a>. These hostnames are matched before any other matching
within the HTTPRoute takes place. Since <code>example.com</code>, <code>foo.example.com</code>, and <code>bar.example.com</code> are separate hosts with
different routing requirements, each is deployed as its own HTTPRoute - <code>example-route, ``foo-route</code>, and <code>bar-route</code>.</p><p>Check the status of the HTTPRoutes:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get httproutes --selector<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>example</span><span style=color:#ce5c00;font-weight:700>=</span>http-routing -o yaml
</span></span></code></pre></div><p>The status for each HTTPRoute should surface &ldquo;Accepted=True&rdquo; and a <code>parentRef</code> that references the example Gateway.
The <code>example-route</code> matches any traffic for &ldquo;example.com&rdquo; and forwards it to the &ldquo;example-svc&rdquo; Service.</p><h2 id=testing-the-configuration>Testing the Configuration</h2><p>Before testing HTTP routing to the <code>example-svc</code> backend, get the Gateway&rsquo;s address.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>GATEWAY_HOST</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>kubectl get gateway/example-gateway -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.status.addresses[0].value}&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span></code></pre></div><p>Test HTTP routing to the <code>example-svc</code> backend.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -vvv --header <span style=color:#4e9a06>&#34;Host: example.com&#34;</span> <span style=color:#4e9a06>&#34;http://</span><span style=color:#4e9a06>${</span><span style=color:#000>GATEWAY_HOST</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>/&#34;</span>
</span></span></code></pre></div><p>A <code>200</code> status code should be returned and the body should include <code>"pod": "example-backend-*"</code> indicating the traffic
was routed to the example backend service. If you change the hostname to a hostname not represented in any of the
HTTPRoutes, e.g. &ldquo;<a href=https://www.example.com>www.example.com</a>&rdquo;, the HTTP traffic will not be routed and a <code>404</code> should be returned.</p><p>The <code>foo-route</code> matches any traffic for <code>foo.example.com</code> and applies its routing rules to forward the traffic to the
&ldquo;foo-svc&rdquo; Service. Since there is only one path prefix match for <code>/login</code>, only <code>foo.example.com/login/*</code> traffic will
be forwarded. Test HTTP routing to the <code>foo-svc</code> backend.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -vvv --header <span style=color:#4e9a06>&#34;Host: foo.example.com&#34;</span> <span style=color:#4e9a06>&#34;http://</span><span style=color:#4e9a06>${</span><span style=color:#000>GATEWAY_HOST</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>/login&#34;</span>
</span></span></code></pre></div><p>A <code>200</code> status code should be returned and the body should include <code>"pod": "foo-backend-*"</code> indicating the traffic
was routed to the foo backend service. Traffic to any other paths that do not begin with <code>/login</code> will not be matched by
this HTTPRoute. Test this by removing <code>/login</code> from the request.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -vvv --header <span style=color:#4e9a06>&#34;Host: foo.example.com&#34;</span> <span style=color:#4e9a06>&#34;http://</span><span style=color:#4e9a06>${</span><span style=color:#000>GATEWAY_HOST</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>/&#34;</span>
</span></span></code></pre></div><p>The HTTP traffic will not be routed and a <code>404</code> should be returned.</p><p>Similarly, the <code>bar-route</code> HTTPRoute matches traffic for <code>bar.example.com</code>. All traffic for this hostname will be
evaluated against the routing rules. The most specific match will take precedence which means that any traffic with the
<code>env:canary</code> header will be forwarded to <code>bar-svc-canary</code> and if the header is missing or not <code>canary</code> then it&rsquo;ll be
forwarded to <code>bar-svc</code>. Test HTTP routing to the <code>bar-svc</code> backend.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -vvv --header <span style=color:#4e9a06>&#34;Host: bar.example.com&#34;</span> <span style=color:#4e9a06>&#34;http://</span><span style=color:#4e9a06>${</span><span style=color:#000>GATEWAY_HOST</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>/&#34;</span>
</span></span></code></pre></div><p>A <code>200</code> status code should be returned and the body should include <code>"pod": "bar-backend-*"</code> indicating the traffic
was routed to the foo backend service.</p><p>Test HTTP routing to the <code>bar-canary-svc</code> backend by adding the <code>env: canary</code> header to the request.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -vvv --header <span style=color:#4e9a06>&#34;Host: bar.example.com&#34;</span> --header <span style=color:#4e9a06>&#34;env: canary&#34;</span> <span style=color:#4e9a06>&#34;http://</span><span style=color:#4e9a06>${</span><span style=color:#000>GATEWAY_HOST</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>/&#34;</span>
</span></span></code></pre></div><p>A <code>200</code> status code should be returned and the body should include <code>"pod": "bar-canary-backend-*"</code> indicating the
traffic was routed to the foo backend service.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-c1cabbd3cbd8653e1244e261cf3b50d1>5 - HTTPRoute Traffic Splitting</h1><p>The <a href=https://gateway-api.sigs.k8s.io/api-types/httproute/>HTTPRoute</a> resource allows one or more <a href=https://gateway-api.sigs.k8s.io/references/spec/#gateway.networking.k8s.io/v1beta1.BackendRef>backendRefs</a> to be provided. Requests will be routed to these upstreams
if they match the rules of the HTTPRoute. If an invalid backendRef is configured, then HTTP responses will be returned
with status code <code>500</code> for all requests that would have been sent to that backend.</p><h2 id=installation>Installation</h2><p>Follow the steps from the <a href=quickstart.md>Quickstart Guide</a> to install Envoy Gateway and the example manifest.
Before proceeding, you should be able to query the example backend using HTTP.</p><h2 id=single-backendref>Single backendRef</h2><p>When a single backendRef is configured in a HTTPRoute, it will receive 100% of the traffic.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: gateway.networking.k8s.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: HTTPRoute
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: http-headers
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  parentRefs:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - name: eg
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  hostnames:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - backends.example
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  rules:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - matches:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - path:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        type: PathPrefix
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        value: /
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    backendRefs:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      kind: Service
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      name: backend
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      port: 3000
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p>The HTTPRoute status should indicate that it has been accepted and is bound to the example Gateway.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get httproute/http-headers -o yaml
</span></span></code></pre></div><p>Get the Gateway&rsquo;s address:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>GATEWAY_HOST</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>kubectl get gateway/eg -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.status.addresses[0].value}&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span></code></pre></div><p>Querying <code>backends.example/get</code> should result in a <code>200</code> response from the example Gateway and the output from the
example app should indicate which pod handled the request. There is only one pod in the deployment for the example app
from the quickstart, so it will be the same on all subsequent requests.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> curl -vvv --header <span style=color:#4e9a06>&#34;Host: backends.example&#34;</span> <span style=color:#4e9a06>&#34;http://</span><span style=color:#4e9a06>${</span><span style=color:#000>GATEWAY_HOST</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>:8080/get&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>...
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#8f5902>&gt;</span> GET /get HTTP/1.1
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> Host: backends.example
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> User-Agent: curl/7.81.0
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> Accept: */*
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> add-header: something
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> 
</span></span><span style=display:flex><span>* Mark bundle as not supporting multiuse
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; HTTP/1.1 200 OK
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; content-type: application/json
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; x-content-type-options: nosniff
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; content-length: 474
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; x-envoy-upstream-service-time: 0
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; server: envoy
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; 
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>...
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic> &#34;namespace&#34;: &#34;default&#34;,
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic> &#34;ingress&#34;: &#34;&#34;,
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic> &#34;service&#34;: &#34;&#34;,
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic> &#34;pod&#34;: &#34;backend-79665566f5-s589f&#34;
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>...
</span></span></span></code></pre></div><h2 id=multiple-backendrefs>Multiple backendRefs</h2><p>If multiple backendRefs are configured, then traffic will be split between the backendRefs equally unless a weight is
configured.</p><p>First, create a second instance of the example app from the quickstart:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>---
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: ServiceAccount
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: backend-2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>---
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: Service
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: backend-2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  labels:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    app: backend-2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    service: backend-2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  ports:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - name: http
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      port: 3000
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      targetPort: 3000
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  selector:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    app: backend-2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>---
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: apps/v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: Deployment
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: backend-2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  replicas: 1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  selector:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      app: backend-2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      version: v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  template:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      labels:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        app: backend-2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        version: v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      serviceAccountName: backend-2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      containers:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        - image: gcr.io/k8s-staging-ingressconformance/echoserver:v20221109-7ee2f3e
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          imagePullPolicy: IfNotPresent
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          name: backend-2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          ports:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            - containerPort: 3000
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          env:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            - name: POD_NAME
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>              valueFrom:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                fieldRef:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                  fieldPath: metadata.name
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            - name: NAMESPACE
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>              valueFrom:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                fieldRef:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                  fieldPath: metadata.namespace
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p>Then create an HTTPRoute that uses both the app from the quickstart and the second instance that was just created</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: gateway.networking.k8s.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: HTTPRoute
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: http-headers
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  parentRefs:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - name: eg
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  hostnames:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - backends.example
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  rules:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - matches:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - path:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        type: PathPrefix
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        value: /
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    backendRefs:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      kind: Service
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      name: backend
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      port: 3000
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      kind: Service
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      name: backend-2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      port: 3000
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p>Querying <code>backends.example/get</code> should result in <code>200</code> responses from the example Gateway and the output from the
example app that indicates which pod handled the request should switch between the first pod and the second one from the
new deployment on subsequent requests.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> curl -vvv --header <span style=color:#4e9a06>&#34;Host: backends.example&#34;</span> <span style=color:#4e9a06>&#34;http://</span><span style=color:#4e9a06>${</span><span style=color:#000>GATEWAY_HOST</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>:8080/get&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>...
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#8f5902>&gt;</span> GET /get HTTP/1.1
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> Host: backends.example
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> User-Agent: curl/7.81.0
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> Accept: */*
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> add-header: something
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> 
</span></span><span style=display:flex><span>* Mark bundle as not supporting multiuse
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; HTTP/1.1 200 OK
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; content-type: application/json
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; x-content-type-options: nosniff
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; content-length: 474
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; x-envoy-upstream-service-time: 0
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; server: envoy
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; 
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>...
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic> &#34;namespace&#34;: &#34;default&#34;,
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic> &#34;ingress&#34;: &#34;&#34;,
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic> &#34;service&#34;: &#34;&#34;,
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic> &#34;pod&#34;: &#34;backend-75bcd4c969-lsxpz&#34;
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>...
</span></span></span></code></pre></div><h2 id=weighted-backendrefs>Weighted backendRefs</h2><p>If multiple backendRefs are configured and an un-even traffic split between the backends is desired, then the <code>weight</code>
field can be used to control the weight of requests to each backend. If weight is not configured for a backendRef it is
assumed to be <code>1</code>.</p><p>The <a href=https://gateway-api.sigs.k8s.io/references/spec/#gateway.networking.k8s.io/v1beta1.BackendRef>weight field in a backendRef</a> controls the distribution of the traffic split. The proportion of
requests to a single backendRef is calculated by dividing its <code>weight</code> by the sum of all backendRef weights in the
HTTPRoute. The weight is not a percentage and the sum of all weights does not need to add up to 100.</p><p>The HTTPRoute below will configure the gateway to send 80% of the traffic to the backend service, and 20% to the
backend-2 service.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: gateway.networking.k8s.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: HTTPRoute
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: http-headers
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  parentRefs:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - name: eg
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  hostnames:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - backends.example
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  rules:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - matches:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - path:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        type: PathPrefix
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        value: /
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    backendRefs:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      kind: Service
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      name: backend
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      port: 3000
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      weight: 8
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      kind: Service
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      name: backend-2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      port: 3000
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      weight: 2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><h2 id=invalid-backendrefs>Invalid backendRefs</h2><p>backendRefs can be considered invalid for the following reasons:</p><ul><li>The <code>group</code> field is configured to something other than <code>""</code>. Currently, only the core API group (specified by
omitting the group field or setting it to an empty string) is supported</li><li>The <code>kind</code> field is configured to anything other than <code>Service</code>. Envoy Gateway currently only supports Kubernetes
Service backendRefs</li><li>The backendRef configures a service with a <code>namespace</code> not permitted by any existing ReferenceGrants</li><li>The <code>port</code> field is not configured or is configured to a port that does not exist on the Service</li><li>The named Service configured by the backendRef cannot be found</li></ul><p>Modifying the above example to make the backend-2 backendRef invalid by using a port that does not exist on the Service
will result in 80% of the traffic being sent to the backend service, and 20% of the traffic receiving an HTTP response
with status code <code>500</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: gateway.networking.k8s.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: HTTPRoute
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: http-headers
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  parentRefs:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - name: eg
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  hostnames:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - backends.example
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  rules:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  - matches:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - path:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        type: PathPrefix
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        value: /
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    backendRefs:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      kind: Service
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      name: backend
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      port: 3000
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      weight: 8
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      kind: Service
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      name: backend-2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      port: 9000
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      weight: 2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p>Querying <code>backends.example/get</code> should result in <code>200</code> responses 80% of the time, and <code>500</code> responses 20% of the time.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> curl -vvv --header <span style=color:#4e9a06>&#34;Host: backends.example&#34;</span> <span style=color:#4e9a06>&#34;http://</span><span style=color:#4e9a06>${</span><span style=color:#000>GATEWAY_HOST</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>:8080/get&#34;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> GET /get HTTP/1.1
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> Host: backends.example
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> User-Agent: curl/7.81.0
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> Accept: */*
</span></span><span style=display:flex><span><span style=color:#8f5902>&gt;</span> 
</span></span><span style=display:flex><span>* Mark bundle as not supporting multiuse
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; HTTP/1.1 500 Internal Server Error
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; server: envoy
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt; content-length: 0
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>&lt;
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-2ea9b8e571f196c8677b198dcbe4720f>6 - Secure Gateways</h1><p>This guide will help you get started using secure Gateways. The guide uses a self-signed CA, so it should be used for
testing and demonstration purposes only.</p><h2 id=prerequisites>Prerequisites</h2><ul><li>OpenSSL to generate TLS assets.</li></ul><h2 id=installation>Installation</h2><p>Follow the steps from the <a href=quickstart.md>Quickstart Guide</a> to install Envoy Gateway and the example manifest.
Before proceeding, you should be able to query the example backend using HTTP.</p><h2 id=tls-certificates>TLS Certificates</h2><p>Generate the certificates and keys used by the Gateway to terminate client TLS connections.</p><p>Create a root certificate and private key to sign certificates:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>openssl req -x509 -sha256 -nodes -days <span style=color:#0000cf;font-weight:700>365</span> -newkey rsa:2048 -subj <span style=color:#4e9a06>&#39;/O=example Inc./CN=example.com&#39;</span> -keyout example.com.key -out example.com.crt
</span></span></code></pre></div><p>Create a certificate and a private key for <code>www.example.com</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>openssl req -out www.example.com.csr -newkey rsa:2048 -nodes -keyout www.example.com.key -subj <span style=color:#4e9a06>&#34;/CN=www.example.com/O=example organization&#34;</span>
</span></span><span style=display:flex><span>openssl x509 -req -days <span style=color:#0000cf;font-weight:700>365</span> -CA example.com.crt -CAkey example.com.key -set_serial <span style=color:#0000cf;font-weight:700>0</span> -in www.example.com.csr -out www.example.com.crt
</span></span></code></pre></div><p>Store the cert/key in a Secret:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create secret tls example-cert --key<span style=color:#ce5c00;font-weight:700>=</span>www.example.com.key --cert<span style=color:#ce5c00;font-weight:700>=</span>www.example.com.crt
</span></span></code></pre></div><p>Update the Gateway from the Quickstart guide to include an HTTPS listener that listens on port <code>8443</code> and references the
<code>example-cert</code> Secret:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl patch gateway eg --type<span style=color:#ce5c00;font-weight:700>=</span>json --patch <span style=color:#4e9a06>&#39;[{
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>   &#34;op&#34;: &#34;add&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>   &#34;path&#34;: &#34;/spec/listeners/-&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>   &#34;value&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      &#34;name&#34;: &#34;https&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      &#34;protocol&#34;: &#34;HTTPS&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      &#34;port&#34;: 8443,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      &#34;tls&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        &#34;mode&#34;: &#34;Terminate&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        &#34;certificateRefs&#34;: [{
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          &#34;kind&#34;: &#34;Secret&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          &#34;group&#34;: &#34;&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          &#34;name&#34;: &#34;example-cert&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        }],
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      },
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    },
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>}]&#39;</span>
</span></span></code></pre></div><p>Verify the Gateway status:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get gateway/eg -o yaml
</span></span></code></pre></div><h2 id=testing>Testing</h2><h3 id=clusters-without-external-loadbalancer-support>Clusters without External LoadBalancer Support</h3><p>Get the name of the Envoy service created the by the example Gateway:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>ENVOY_SERVICE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>kubectl get svc -n envoy-gateway-system --selector<span style=color:#ce5c00;font-weight:700>=</span>gateway.envoyproxy.io/owning-gateway-namespace<span style=color:#ce5c00;font-weight:700>=</span>default,gateway.envoyproxy.io/owning-gateway-name<span style=color:#ce5c00;font-weight:700>=</span>eg -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.items[0].metadata.name}&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span></code></pre></div><p>Port forward to the Envoy service:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl -n envoy-gateway-system port-forward service/<span style=color:#4e9a06>${</span><span style=color:#000>ENVOY_SERVICE</span><span style=color:#4e9a06>}</span> 8043:8443 <span style=color:#000;font-weight:700>&amp;</span>
</span></span></code></pre></div><p>Query the example app through Envoy proxy:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -v -HHost:www.example.com --resolve <span style=color:#4e9a06>&#34;www.example.com:8043:127.0.0.1&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--cacert example.com.crt https://www.example.com:8043/get
</span></span></code></pre></div><h3 id=clusters-with-external-loadbalancer-support>Clusters with External LoadBalancer Support</h3><p>Get the External IP of the Gateway:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>GATEWAY_HOST</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>kubectl get gateway/eg -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.status.addresses[0].value}&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span></code></pre></div><p>Query the example app through the Gateway:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -v -HHost:www.example.com --resolve <span style=color:#4e9a06>&#34;www.example.com:8443:</span><span style=color:#4e9a06>${</span><span style=color:#000>GATEWAY_HOST</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--cacert example.com.crt https://www.example.com:8443/get
</span></span></code></pre></div><h2 id=multiple-https-listeners>Multiple HTTPS Listeners</h2><p>Create a TLS cert/key for the additional HTTPS listener:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>openssl req -out foo.example.com.csr -newkey rsa:2048 -nodes -keyout foo.example.com.key -subj <span style=color:#4e9a06>&#34;/CN=foo.example.com/O=example organization&#34;</span>
</span></span><span style=display:flex><span>openssl x509 -req -days <span style=color:#0000cf;font-weight:700>365</span> -CA example.com.crt -CAkey example.com.key -set_serial <span style=color:#0000cf;font-weight:700>0</span> -in foo.example.com.csr -out foo.example.com.crt
</span></span></code></pre></div><p>Store the cert/key in a Secret:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create secret tls foo-cert --key<span style=color:#ce5c00;font-weight:700>=</span>foo.example.com.key --cert<span style=color:#ce5c00;font-weight:700>=</span>foo.example.com.crt
</span></span></code></pre></div><p>Create another HTTPS listener on the example Gateway:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl patch gateway eg --type<span style=color:#ce5c00;font-weight:700>=</span>json --patch <span style=color:#4e9a06>&#39;[{
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>   &#34;op&#34;: &#34;add&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>   &#34;path&#34;: &#34;/spec/listeners/-&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>   &#34;value&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      &#34;name&#34;: &#34;https-foo&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      &#34;protocol&#34;: &#34;HTTPS&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      &#34;port&#34;: 8443,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      &#34;hostname&#34;: &#34;foo.example.com&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      &#34;tls&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        &#34;mode&#34;: &#34;Terminate&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        &#34;certificateRefs&#34;: [{
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          &#34;kind&#34;: &#34;Secret&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          &#34;group&#34;: &#34;&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          &#34;name&#34;: &#34;foo-cert&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        }],
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      },
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    },
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>}]&#39;</span>
</span></span></code></pre></div><p>Update the HTTPRoute to route traffic for hostname <code>foo.example.com</code> to the example backend service:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl patch httproute backend --type<span style=color:#ce5c00;font-weight:700>=</span>json --patch <span style=color:#4e9a06>&#39;[{
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>   &#34;op&#34;: &#34;add&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>   &#34;path&#34;: &#34;/spec/hostnames/-&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>   &#34;value&#34;: &#34;foo.example.com&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>}]&#39;</span>
</span></span></code></pre></div><p>Verify the Gateway status:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get gateway/eg -o yaml
</span></span></code></pre></div><p>Follow the steps in the <a href=#testing>Testing section</a> to test connectivity to the backend app through both Gateway
listeners. Replace <code>www.example.com</code> with <code>foo.example.com</code> to test the new HTTPS listener.</p><h2 id=cross-namespace-certificate-references>Cross Namespace Certificate References</h2><p>A Gateway can be configured to reference a certificate in a different namespace. This is allowed by a <a href=https://gateway-api.sigs.k8s.io/api-types/referencegrant/>ReferenceGrant</a>
created in the target namespace. Without the ReferenceGrant, a cross-namespace reference is invalid.</p><p>Before proceeding, ensure you can query the HTTPS backend service from the <a href=#testing>Testing section</a>.</p><p>To demonstrate cross namespace certificate references, create a ReferenceGrant that allows Gateways from the &ldquo;default&rdquo;
namespace to reference Secrets in the &ldquo;envoy-gateway-system&rdquo; namespace:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> cat &lt;&lt;EOF <span style=color:#000;font-weight:700>|</span> kubectl apply -f -
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>apiVersion: gateway.networking.k8s.io/v1alpha2
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>kind: ReferenceGrant
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>metadata:
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  name: example
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  namespace: envoy-gateway-system
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>spec:
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  from:
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  - group: gateway.networking.k8s.io
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>    kind: Gateway
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>    namespace: default
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  to:
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  - group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>    kind: Secret
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>EOF
</span></span></span></code></pre></div><p>Delete the previously created Secret:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete secret/example-cert
</span></span></code></pre></div><p>The Gateway HTTPS listener should now surface the <code>Ready: False</code> status condition and the example HTTPS backend should
no longer be reachable through the Gateway.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get gateway/eg -o yaml
</span></span></code></pre></div><p>Recreate the example Secret in the <code>envoy-gateway-system</code> namespace:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create secret tls example-cert -n envoy-gateway-system --key<span style=color:#ce5c00;font-weight:700>=</span>www.example.com.key --cert<span style=color:#ce5c00;font-weight:700>=</span>www.example.com.crt
</span></span></code></pre></div><p>Update the Gateway HTTPS listener with <code>namespace: envoy-gateway-system</code>, for example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> cat &lt;&lt;EOF <span style=color:#000;font-weight:700>|</span> kubectl apply -f -
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>apiVersion: gateway.networking.k8s.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>kind: Gateway
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>metadata:
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  name: eg
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>spec:
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  gatewayClassName: eg
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  listeners:
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>    - name: http
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>      protocol: HTTP
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>      port: 8080
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>    - name: https
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>      protocol: HTTPS
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>      port: 8443
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>      tls:
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>        mode: Terminate
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>        certificateRefs:
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>          - kind: Secret
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>            group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>            name: example-cert
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>            namespace: envoy-gateway-system
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>EOF
</span></span></span></code></pre></div><p>The Gateway HTTPS listener status should now surface the <code>Ready: True</code> condition and you should once again be able to
query the HTTPS backend through the Gateway.</p><p>Lastly, test connectivity using the above <a href=#testing>Testing section</a>.</p><h2 id=clean-up>Clean-Up</h2><p>Follow the steps from the <a href=quickstart.md>Quickstart Guide</a> to uninstall Envoy Gateway and the example manifest.</p><p>Delete the Secrets:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete secret/example-cert
</span></span><span style=display:flex><span>kubectl delete secret/foo-cert
</span></span></code></pre></div><h2 id=next-steps>Next Steps</h2><p>Checkout the <a href=../dev/README.md>Developer Guide</a> to get involved in the project.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-841e8473f143ae200856727279a10455>7 - TLS Passthrough</h1><p>This guide will walk through the steps required to configure TLS Passthrough via Envoy Gateway. Unlike configuring
Secure Gateways, where the Gateway terminates the client TLS connection, TLS Passthrough allows the application itself
to terminate the TLS connection, while the Gateway routes the requests to the application based on SNI headers.</p><h2 id=prerequisites>Prerequisites</h2><ul><li>OpenSSL to generate TLS assets.</li></ul><h2 id=installation>Installation</h2><p>Follow the steps from the <a href=quickstart.md>Quickstart Guide</a> to install Envoy Gateway and the example manifest.
Before proceeding, you should be able to query the example backend using HTTP.</p><h2 id=tls-certificates>TLS Certificates</h2><p>Generate the certificates and keys used by the Service to terminate client TLS connections.
For the application, we&rsquo;ll deploy a sample echoserver app, with the certificates loaded in the application Pod.</p><p><strong>Note:</strong> These certificates will not be used by the Gateway, but will remain in the application scope.</p><p>Create a root certificate and private key to sign certificates:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>openssl req -x509 -sha256 -nodes -days <span style=color:#0000cf;font-weight:700>365</span> -newkey rsa:2048 -subj <span style=color:#4e9a06>&#39;/O=example Inc./CN=example.com&#39;</span> -keyout example.com.key -out example.com.crt
</span></span></code></pre></div><p>Create a certificate and a private key for <code>passthrough.example.com</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>openssl req -out passthrough.example.com.csr -newkey rsa:2048 -nodes -keyout passthrough.example.com.key -subj <span style=color:#4e9a06>&#34;/CN=passthrough.example.com/O=some organization&#34;</span>
</span></span><span style=display:flex><span>openssl x509 -req -sha256 -days <span style=color:#0000cf;font-weight:700>365</span> -CA example.com.crt -CAkey example.com.key -set_serial <span style=color:#0000cf;font-weight:700>0</span> -in passthrough.example.com.csr -out passthrough.example.com.crt
</span></span></code></pre></div><p>Store the cert/keys in A Secret:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create secret tls server-certs --key<span style=color:#ce5c00;font-weight:700>=</span>passthrough.example.com.key --cert<span style=color:#ce5c00;font-weight:700>=</span>passthrough.example.com.crt
</span></span></code></pre></div><h2 id=deployment>Deployment</h2><p>Deploy TLS Passthrough application Deployment, Service and TLSRoute:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://raw.githubusercontent.com/envoyproxy/gateway/v0.2.0/examples/kubernetes/tls-passthrough.yaml
</span></span></code></pre></div><p>Patch the Gateway from the Quickstart guide to include a TLS listener that listens on port <code>6443</code> and is configured for
TLS mode Passthrough:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl patch gateway eg --type<span style=color:#ce5c00;font-weight:700>=</span>json --patch <span style=color:#4e9a06>&#39;[{
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>   &#34;op&#34;: &#34;add&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>   &#34;path&#34;: &#34;/spec/listeners/-&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>   &#34;value&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      &#34;name&#34;: &#34;tls&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      &#34;protocol&#34;: &#34;TLS&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      &#34;hostname&#34;: &#34;passthrough.example.com&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      &#34;tls&#34;: {&#34;mode&#34;: &#34;Passthrough&#34;}, 
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      &#34;port&#34;: 6443,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    },
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>}]&#39;</span>
</span></span></code></pre></div><h2 id=testing>Testing</h2><h3 id=clusters-without-external-loadbalancer-support>Clusters without External LoadBalancer Support</h3><p>Get the name of the Envoy service created the by the example Gateway:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>ENVOY_SERVICE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>kubectl get svc -n envoy-gateway-system --selector<span style=color:#ce5c00;font-weight:700>=</span>gateway.envoyproxy.io/owning-gateway-namespace<span style=color:#ce5c00;font-weight:700>=</span>default,gateway.envoyproxy.io/owning-gateway-name<span style=color:#ce5c00;font-weight:700>=</span>eg -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.items[0].metadata.name}&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span></code></pre></div><p>Port forward to the Envoy service:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl -n envoy-gateway-system port-forward service/<span style=color:#4e9a06>${</span><span style=color:#000>ENVOY_SERVICE</span><span style=color:#4e9a06>}</span> 6043:6443 <span style=color:#000;font-weight:700>&amp;</span>
</span></span></code></pre></div><p>Curl the example app through Envoy proxy:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -v --resolve <span style=color:#4e9a06>&#34;passthrough.example.com:6043:127.0.0.1&#34;</span> https://passthrough.example.com:6043 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--cacert passthrough.example.com.crt
</span></span></code></pre></div><h3 id=clusters-with-external-loadbalancer-support>Clusters with External LoadBalancer Support</h3><p>You can also test the same functionality by sending traffic to the External IP of the Gateway:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>GATEWAY_HOST</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>kubectl get gateway/eg -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.status.addresses[0].value}&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span></code></pre></div><p>Curl the example app through the Gateway, e.g. Envoy proxy:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -v -HHost:passthrough.example.com --resolve <span style=color:#4e9a06>&#34;passthrough.example.com:6443:</span><span style=color:#4e9a06>${</span><span style=color:#000>GATEWAY_HOST</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--cacert example.com.crt https://passthrough.example.com:6443/get
</span></span></code></pre></div><h2 id=clean-up>Clean-Up</h2><p>Follow the steps from the <a href=quickstart.md>Quickstart Guide</a> to uninstall Envoy Gateway and the example manifest.</p><p>Delete the Secret:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete secret/server-certs
</span></span></code></pre></div><h2 id=next-steps>Next Steps</h2><p>Checkout the <a href=../dev/README.md>Developer Guide</a> to get involved in the project.</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="User mailing list" aria-label="User mailing list"><a target=_blank rel=noopener href=mailto:envoy-users@googlegroups.com aria-label="User mailing list"><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Twitter aria-label=Twitter><a target=_blank rel=noopener href=https://twitter.com/EnvoyProxy aria-label=Twitter><i class="fab fa-twitter"></i></a></li></ul></div><div class="col-6 col-sm-4 text-end text-xs-center order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/envoyproxy/gateway aria-label=GitHub><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Slack aria-label=Slack><a target=_blank rel=noopener href=https://envoyproxy.slack.com/archives/C03E6NHLESV aria-label=Slack><i class="fab fa-slack"></i></a></li></ul></div><div class="td-footer__copyright-etc col-12 col-sm-4 text-center py-2 order-sm-2"><span>&copy; 2023 The Envoy Gateway Authors All Rights Reserved</span>
<span class=ms-1><a href=https://policies.google.com/privacy target=_blank rel=noopener>Privacy Policy</a></span><p class="td-footer__about mt-2"><a href=/about/>About Envoy Gateway</a></p></div></div></div></footer></div><script src=/js/main.min.7c61052b3140e141bdd8468f9521f29a18b7823e8ae447bd506913b6beb037d8.js integrity="sha256-fGEFKzFA4UG92EaPlSHymhi3gj6K5Ee9UGkTtr6wN9g=" crossorigin=anonymous></script>
<script defer src=/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script></body></html>