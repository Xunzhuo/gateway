
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>HTTP Response Headers &#8212; Envoy Gateway  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Secure Gateways" href="secure-gateways.html" />
    <link rel="prev" title="HTTP Request Headers" href="http-request-headers.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="http-response-headers">
<h1>HTTP Response Headers<a class="headerlink" href="#http-response-headers" title="Permalink to this heading">¶</a></h1>
<p>The <a class="reference external" href="https://gateway-api.sigs.k8s.io/api-types/httproute/">HTTPRoute</a> resource can modify the headers of a response before responding it to the downstream service. To learn
more about HTTP routing, refer to the <a class="reference external" href="https://gateway-api.sigs.k8s.io/">Gateway API documentation</a>.</p>
<p>A <a class="reference external" href="https://gateway-api.sigs.k8s.io/references/spec/#gateway.networking.k8s.io/v1beta1.HTTPHeaderFilter"><code class="docutils literal notranslate"><span class="pre">ResponseHeaderModifier</span></code> filter</a> instructs Gateways to modify the headers in responses that match the
rule before responding to the downstream. Note that the <code class="docutils literal notranslate"><span class="pre">ResponseHeaderModifier</span></code> filter will only modify headers before
the response is returned from Envoy to the downstream client and will not affect request headers forwarding to the
upstream service.</p>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading">¶</a></h2>
<p>Follow the steps from the <a class="reference internal" href="quickstart.html"><span class="doc std std-doc">Quickstart Guide</span></a> to install Envoy Gateway and the example manifest.
Before proceeding, you should be able to query the example backend using HTTP.</p>
</section>
<section id="adding-response-headers">
<h2>Adding Response Headers<a class="headerlink" href="#adding-response-headers" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">ResponseHeaderModifier</span></code> filter can add new headers to a response before it is sent to the upstream. If the response
does not have the header configured by the filter, then that header will be added to the response. If the response
already has the header configured by the filter, then the value of the header in the filter will be appended to the
value of the header in the response.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<span class="s">apiVersion: gateway.networking.k8s.io/v1beta1</span>
<span class="s">kind: HTTPRoute</span>
<span class="s">metadata:</span>
<span class="s">  name: http-headers</span>
<span class="s">spec:</span>
<span class="s">  parentRefs:</span>
<span class="s">  - name: eg</span>
<span class="s">  hostnames:</span>
<span class="s">  - headers.example</span>
<span class="s">  rules:</span>
<span class="s">  - matches:</span>
<span class="s">    - path:</span>
<span class="s">        type: PathPrefix</span>
<span class="s">        value: /</span>
<span class="s">    backendRefs:</span>
<span class="s">    - group: &quot;&quot;</span>
<span class="s">      kind: Service</span>
<span class="s">      name: backend</span>
<span class="s">      port: 3000</span>
<span class="s">      weight: 1</span>
<span class="s">    filters:</span>
<span class="s">    - type: ResponseHeaderModifier</span>
<span class="s">      responseHeaderModifier:</span>
<span class="s">        add:</span>
<span class="s">        - name: &quot;add-header&quot;</span>
<span class="s">          value: &quot;foo&quot;</span>
<span class="s">EOF</span>
</pre></div>
</div>
<p>The HTTPRoute status should indicate that it has been accepted and is bound to the example Gateway.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>get<span class="w"> </span>httproute/http-headers<span class="w"> </span>-o<span class="w"> </span>yaml
</pre></div>
</div>
<p>Get the Gateway’s address:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">GATEWAY_HOST</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>gateway/eg<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.status.addresses[0].value}&#39;</span><span class="k">)</span>
</pre></div>
</div>
<p>Querying <code class="docutils literal notranslate"><span class="pre">headers.example/get</span></code> should result in a <code class="docutils literal notranslate"><span class="pre">200</span></code> response from the example Gateway and the output from the
example app should indicate that the downstream client received the header <code class="docutils literal notranslate"><span class="pre">add-header</span></code> with the value: <code class="docutils literal notranslate"><span class="pre">foo</span></code></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>curl<span class="w"> </span>-vvv<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Host: headers.example&quot;</span><span class="w"> </span><span class="s2">&quot;http://</span><span class="si">${</span><span class="nv">GATEWAY_HOST</span><span class="si">}</span><span class="s2">/get&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;X-Echo-Set-Header: X-Foo: value1&#39;</span>
<span class="go">...</span>
<span class="go">&gt; GET /get HTTP/1.1</span>
<span class="go">&gt; Host: headers.example</span>
<span class="go">&gt; User-Agent: curl/7.81.0</span>
<span class="go">&gt; Accept: */*</span>
<span class="go">&gt; X-Echo-Set-Header: X-Foo: value1</span>
<span class="go">&gt;</span>
<span class="go">* Mark bundle as not supporting multiuse</span>
<span class="go">&lt; HTTP/1.1 200 OK</span>
<span class="go">&lt; content-type: application/json</span>
<span class="go">&lt; x-content-type-options: nosniff</span>
<span class="go">&lt; content-length: 474</span>
<span class="go">&lt; x-envoy-upstream-service-time: 0</span>
<span class="go">&lt; server: envoy</span>
<span class="go">&lt; x-foo: value1</span>
<span class="go">&lt; add-header: foo</span>
<span class="go">&lt;</span>
<span class="go">...</span>
<span class="go"> &quot;headers&quot;: {</span>
<span class="go">  &quot;Accept&quot;: [</span>
<span class="go">   &quot;*/*&quot;</span>
<span class="go">  ],</span>
<span class="go">  &quot;X-Echo-Set-Header&quot;: [</span>
<span class="go">   &quot;X-Foo: value1&quot;</span>
<span class="go">  ]</span>
<span class="go">...</span>
</pre></div>
</div>
</section>
<section id="setting-response-headers">
<h2>Setting Response Headers<a class="headerlink" href="#setting-response-headers" title="Permalink to this heading">¶</a></h2>
<p>Setting headers is similar to adding headers. If the response does not have the header configured by the filter, then it
will be added, but unlike <a class="reference internal" href="#adding-response-headers"><span class="std std-doc">adding response headers</span></a> which will append the value of the header
if the response already contains it, setting a header will cause the value to be replaced by the value configured in the
filter.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<span class="s">apiVersion: gateway.networking.k8s.io/v1beta1</span>
<span class="s">kind: HTTPRoute</span>
<span class="s">metadata:</span>
<span class="s">  name: http-headers</span>
<span class="s">spec:</span>
<span class="s">  parentRefs:</span>
<span class="s">  - name: eg</span>
<span class="s">  hostnames:</span>
<span class="s">  - headers.example</span>
<span class="s">  rules:</span>
<span class="s">  - backendRefs:</span>
<span class="s">    - group: &quot;&quot;</span>
<span class="s">      kind: Service</span>
<span class="s">      name: backend</span>
<span class="s">      port: 3000</span>
<span class="s">      weight: 1</span>
<span class="s">    matches:</span>
<span class="s">    - path:</span>
<span class="s">        type: PathPrefix</span>
<span class="s">        value: /</span>
<span class="s">    filters:</span>
<span class="s">    - type: ResponseHeaderModifier</span>
<span class="s">      responseHeaderModifier:</span>
<span class="s">        set:</span>
<span class="s">        - name: &quot;set-header&quot;</span>
<span class="s">          value: &quot;foo&quot;</span>
<span class="s">EOF</span>
</pre></div>
</div>
<p>Querying <code class="docutils literal notranslate"><span class="pre">headers.example/get</span></code> should result in a <code class="docutils literal notranslate"><span class="pre">200</span></code> response from the example Gateway and the output from the
example app should indicate that the downstream client received the header <code class="docutils literal notranslate"><span class="pre">set-header</span></code> with the original value <code class="docutils literal notranslate"><span class="pre">value1</span></code>
replaced by <code class="docutils literal notranslate"><span class="pre">foo</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>curl<span class="w"> </span>-vvv<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Host: headers.example&quot;</span><span class="w"> </span><span class="s2">&quot;http://</span><span class="si">${</span><span class="nv">GATEWAY_HOST</span><span class="si">}</span><span class="s2">/get&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;X-Echo-Set-Header: set-header: value1&#39;</span>
<span class="go">...</span>
<span class="go">&gt; GET /get HTTP/1.1</span>
<span class="go">&gt; Host: headers.example</span>
<span class="go">&gt; User-Agent: curl/7.81.0</span>
<span class="go">&gt; Accept: */*</span>
<span class="go">&gt; X-Echo-Set-Header: set-header: value1</span>
<span class="go">&gt;</span>
<span class="go">* Mark bundle as not supporting multiuse</span>
<span class="go">&lt; HTTP/1.1 200 OK</span>
<span class="go">&lt; content-type: application/json</span>
<span class="go">&lt; x-content-type-options: nosniff</span>
<span class="go">&lt; content-length: 474</span>
<span class="go">&lt; x-envoy-upstream-service-time: 0</span>
<span class="go">&lt; server: envoy</span>
<span class="go">&lt; set-header: foo</span>
<span class="go">&lt;</span>
<span class="go"> &quot;headers&quot;: {</span>
<span class="go">  &quot;Accept&quot;: [</span>
<span class="go">   &quot;*/*&quot;</span>
<span class="go">  ],</span>
<span class="go">  &quot;X-Echo-Set-Header&quot;: [</span>
<span class="go">    &quot;set-header&quot;: value1&quot;</span>
<span class="go">  ]</span>
<span class="go">...</span>
</pre></div>
</div>
</section>
<section id="removing-response-headers">
<h2>Removing Response Headers<a class="headerlink" href="#removing-response-headers" title="Permalink to this heading">¶</a></h2>
<p>Headers can be removed from a response by simply supplying a list of header names.</p>
<p>Setting headers is similar to adding headers. If the response does not have the header configured by the filter, then it
will be added, but unlike <a class="reference internal" href="#adding-response-headers"><span class="std std-doc">adding response headers</span></a> which will append the value of the header
if the response already contains it, setting a header will cause the value to be replaced by the value configured in the
filter.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<span class="s">apiVersion: gateway.networking.k8s.io/v1beta1</span>
<span class="s">kind: HTTPRoute</span>
<span class="s">metadata:</span>
<span class="s">  name: http-headers</span>
<span class="s">spec:</span>
<span class="s">  parentRefs:</span>
<span class="s">  - name: eg</span>
<span class="s">  hostnames:</span>
<span class="s">  - headers.example</span>
<span class="s">  rules:</span>
<span class="s">  - matches:</span>
<span class="s">    - path:</span>
<span class="s">        type: PathPrefix</span>
<span class="s">        value: /</span>
<span class="s">    backendRefs:</span>
<span class="s">    - group: &quot;&quot;</span>
<span class="s">      name: backend</span>
<span class="s">      port: 3000</span>
<span class="s">      weight: 1</span>
<span class="s">    filters:</span>
<span class="s">    - type: ResponseHeaderModifier</span>
<span class="s">      responseHeaderModifier:</span>
<span class="s">        remove:</span>
<span class="s">        - &quot;remove-header&quot;</span>
<span class="s">EOF</span>
</pre></div>
</div>
<p>Querying <code class="docutils literal notranslate"><span class="pre">headers.example/get</span></code> should result in a <code class="docutils literal notranslate"><span class="pre">200</span></code> response from the example Gateway and the output from the
example app should indicate that the header <code class="docutils literal notranslate"><span class="pre">remove-header</span></code> that was sent by curl was removed before the upstream
received the response.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>curl<span class="w"> </span>-vvv<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Host: headers.example&quot;</span><span class="w"> </span><span class="s2">&quot;http://</span><span class="si">${</span><span class="nv">GATEWAY_HOST</span><span class="si">}</span><span class="s2">/get&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;X-Echo-Set-Header: remove-header: value1&#39;</span>
<span class="go">...</span>
<span class="go">&gt; GET /get HTTP/1.1</span>
<span class="go">&gt; Host: headers.example</span>
<span class="go">&gt; User-Agent: curl/7.81.0</span>
<span class="go">&gt; Accept: */*</span>
<span class="go">&gt; X-Echo-Set-Header: remove-header: value1</span>
<span class="go">&gt;</span>
<span class="go">* Mark bundle as not supporting multiuse</span>
<span class="go">&lt; HTTP/1.1 200 OK</span>
<span class="go">&lt; content-type: application/json</span>
<span class="go">&lt; x-content-type-options: nosniff</span>
<span class="go">&lt; content-length: 474</span>
<span class="go">&lt; x-envoy-upstream-service-time: 0</span>
<span class="go">&lt; server: envoy</span>
<span class="go">&lt;</span>

<span class="go"> &quot;headers&quot;: {</span>
<span class="go">  &quot;Accept&quot;: [</span>
<span class="go">   &quot;*/*&quot;</span>
<span class="go">  ],</span>
<span class="go">  &quot;X-Echo-Set-Header&quot;: [</span>
<span class="go">    &quot;remove-header&quot;: value1&quot;</span>
<span class="go">  ]</span>
<span class="go">...</span>
</pre></div>
</div>
</section>
<section id="combining-filters">
<h2>Combining Filters<a class="headerlink" href="#combining-filters" title="Permalink to this heading">¶</a></h2>
<p>Headers can be added/set/removed in a single filter on the same HTTPRoute and they will all perform as expected</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<span class="s">apiVersion: gateway.networking.k8s.io/v1beta1</span>
<span class="s">kind: HTTPRoute</span>
<span class="s">metadata:</span>
<span class="s">  name: http-headers</span>
<span class="s">spec:</span>
<span class="s">  parentRefs:</span>
<span class="s">  - name: eg</span>
<span class="s">  hostnames:</span>
<span class="s">  - headers.example</span>
<span class="s">  rules:</span>
<span class="s">  - matches:</span>
<span class="s">    - path:</span>
<span class="s">        type: PathPrefix</span>
<span class="s">        value: /</span>
<span class="s">    backendRefs:</span>
<span class="s">    - group: &quot;&quot;</span>
<span class="s">      kind: Service</span>
<span class="s">      name: backend</span>
<span class="s">      port: 3000</span>
<span class="s">      weight: 1</span>
<span class="s">    filters:</span>
<span class="s">    - type: ResponseHeaderModifier</span>
<span class="s">      responseHeaderModifier:</span>
<span class="s">        add:</span>
<span class="s">        - name: &quot;add-header-1&quot;</span>
<span class="s">          value: &quot;foo&quot;</span>
<span class="s">        set:</span>
<span class="s">        - name: &quot;set-header-1&quot;</span>
<span class="s">          value: &quot;bar&quot;</span>
<span class="s">        remove:</span>
<span class="s">        - &quot;removed-header&quot;</span>
<span class="s">EOF</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Envoy Gateway</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/compatibility.html">Compatibility Matrix</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../user_docs.html">User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design_docs.html">Design Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_docs.html">Developer Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_docs.html">API Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about_docs.html">About the Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_involved.html">Getting Involved</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../user_docs.html">User Guides</a><ul>
      <li>Previous: <a href="http-request-headers.html" title="previous chapter">HTTP Request Headers</a></li>
      <li>Next: <a href="secure-gateways.html" title="next chapter">Secure Gateways</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;Envoy Gateway Project Authors | <a href="https://github.com/envoyproxy/gateway">GitHub</a> | <a href="/latest">Latest Docs</a>.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../_sources/user/http-response-headers.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>